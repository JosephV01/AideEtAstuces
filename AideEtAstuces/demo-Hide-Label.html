<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démonstration - Masquer l'Étiquette - MyCustomDesk</title>
    <link rel="stylesheet" href="HelpAndTips.css">
    <link rel="stylesheet" href="demo-elements.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: var(--background-white);
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .demo-container {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            text-align: center;
        }

        .demo-canvas-container {
            background: #2D2D2D;
            border: 2px solid #555555;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        .demo-title {
            color: var(--text-color);
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .demo-description {
            color: var(--text-light);
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Menu contextuel adaptatif (override de demo-elements.css) */
        .context-menu {
            width: auto;
            min-width: 100px;
            height: auto;
        }

        .menu-item {
            padding: 3px 8px;
            margin: 1px 0;
            font-size: 8px;
            height: 16px;
            white-space: nowrap;
            min-width: fit-content;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .menu-icon {
            flex-shrink: 0;
            color: #F0F0F0;
            width: 12px;
            height: 12px;
        }

        .menu-separator {
            margin: 1px 4px;
        }

        .menu-with-submenu {
            position: relative;
        }

        .submenu {
            position: absolute;
            left: 100%;
            top: -2px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 6px;
            min-width: 140px;
            visibility: hidden;
            opacity: 0;
            transform: translateX(-5px);
            transition: all 0.2s ease;
            z-index: 1000;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
            padding: 4px 2px;
        }

        .submenu-item {
            padding: 5px 10px;
            margin: 2px 0;
            font-size: 10px;
            height: 20px;
            white-space: nowrap;
            min-width: fit-content;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #F0F0F0;
            background: transparent;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
        }

        .submenu-item:hover {
            background: #404040;
        }

        .mouse-cursor {
            z-index: 1500 !important;
        }


        /* Poignée de redimensionnement (ajustement pour cette démo) */
        .resize-handle {
            width: 12px;
            height: 12px;
            left: 243px;
            top: 133px;
            z-index: 5;
        }

        .back-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">Démonstration - Masquer l'Étiquette</h1>
        <p class="demo-description">
            Cette démonstration montre comment masquer l'étiquette d'une bulle via le menu contextuel "Options de l'étiquette".
        </p>
        
        <div class="demo-canvas-container">
            <div class="demo-canvas">
                <!-- Bordure dynamique -->
                <div class="dynamic-border"></div>

                <!-- Étiquette centrée automatiquement -->
                <div class="label-border">
                    <div class="label-text">Masquer l'Étiquette</div>
                </div>

                <!-- Curseur de souris -->
                <div class="mouse-cursor"></div>

                <!-- Poignée de redimensionnement -->
                <div class="resize-handle"></div>

                <!-- Cercle d'animation de clic -->
                <div class="click-animation"></div>

                <!-- Souris avec boutons (état normal) -->
                <div class="mouse-zero-click"></div>

                <!-- Souris avec bouton droit coloré (pour les clics) -->
                <div class="mouse-right-click"></div>

                <!-- Souris avec bouton gauche coloré (pour les clics) -->
                <div class="mouse-left-click"></div>

                <!-- Menu contextuel simulé -->
                <div class="context-menu">
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z" fill="currentColor"/>
                        </svg>
                        Personnaliser la bulle
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item menu-with-submenu" id="label-options-menu">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M570-82q-19 5-34.5-6.5T520-120v-200q0-20 15.5-31.5T571-358q37 10 74 14t75 4q38 0 75.5-4t74.5-14q19-5 34.5 6.5T920-320v200q0 20-15.5 31.5T870-82q-37-10-74.5-14t-75.5-4q-38 0-75.5 4T570-82Zm-90-398ZM370-80l-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v33.5q0 10-2 20h-82q2-10 3-20t1-20q-1-19-3-33.5t-6-27.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q24 25 54 42t65 22v184h-70Zm70-266v-91q-8-8-13-19t-5-24q0-25 17.5-42.5T482-540q25 0 42.5 17.5T542-480q0 11-3.5 21.5T527-440h89q3-10 4.5-19.5T622-480q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 48 27.5 84t70.5 50Z" fill="currentColor"/>
                        </svg>
                        Options de l'étiquette
                        <div class="submenu" id="label-submenu">
                            <div class="menu-item submenu-item">
                                <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                                    <path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm640-560H160v480h640v-480Zm-640 0v480-480Zm200 360v-240L240-480l120 120Zm360-120L600-600v240l120-120Z" fill="currentColor"/>
                                </svg>
                                Ajuster position
                            </div>
                            <div class="menu-item submenu-item" id="hide-label-item" data-text-hide="Masquer l'étiquette" data-text-show="Afficher l'étiquette">
                                <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                                    <path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z" fill="currentColor"/>
                                </svg>
                                <span class="label-option-text">Masquer l'étiquette</span>
                            </div>
                        </div>
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z" fill="currentColor"/>
                        </svg>
                        Éditer
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M520-400h80v-120h120v-80H600v-120h-80v120H400v80h120v120ZM320-240q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H320Zm0-80h480v-480H320v480ZM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80H160Zm160-720v480-480Z" fill="currentColor"/>
                        </svg>
                        Dupliquer
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520Zm-400 0v520-520Z" fill="currentColor"/>
                        </svg>
                        Supprimer
                    </div>
                </div>
            </div>
        </div>

        <button class="back-button" onclick="window.close()">Fermer</button>
    </div>

    <script>
        // Variables pour l'animation
        let animationPhase = 0;
        let animationTimer;
        let isLabelVisible = true; // État de l'étiquette : true = visible, false = masquée

        // Éléments DOM
        const mouseCursor = document.querySelector('.mouse-cursor');
        const mouseZeroClick = document.querySelector('.mouse-zero-click');
        const mouseRightClick = document.querySelector('.mouse-right-click');
        const mouseLeftClick = document.querySelector('.mouse-left-click');
        const clickAnimation = document.querySelector('.click-animation');
        const contextMenu = document.querySelector('.context-menu');
        const labelBorder = document.querySelector('.label-border');
        const labelOptionsMenu = document.querySelector('#label-options-menu');
        const submenu = document.querySelector('#label-submenu');
        const hideLabelItem = document.querySelector('#hide-label-item');
        const canvas = document.querySelector('.demo-canvas');
        let labelCenterX = 300;
        let labelCenterY = 127;
        let bubbleCenterX = 300;
        let bubbleCenterY = 200;

        // Fonction pour mettre à jour le texte et l'icône de la sous-option
        function updateLabelOptionState() {
            const iconElement = hideLabelItem.querySelector('.menu-icon');
            const textElement = hideLabelItem.querySelector('.label-option-text');
            
            if (isLabelVisible) {
                // État : étiquette visible -> option "Masquer l'étiquette"
                if (textElement) {
                    textElement.textContent = hideLabelItem.getAttribute('data-text-hide');
                }
                
                // Mettre à jour l'icône (œil barré)
                if (iconElement) {
                    iconElement.innerHTML = '<path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z" fill="currentColor"/>';
                }
            } else {
                // État : étiquette masquée -> option "Afficher l'étiquette"
                if (textElement) {
                    textElement.textContent = hideLabelItem.getAttribute('data-text-show');
                }
                
                // Mettre à jour l'icône (œil normal)
                if (iconElement) {
                    iconElement.innerHTML = '<path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z" fill="currentColor"/>';
                }
            }
        }

        function startAnimation() {
            // Position initiale du curseur selon demo-elements.css (143px, 92px)
            mouseCursor.style.left = '143px';
            mouseCursor.style.top = '92px';
            mouseCursor.style.visibility = 'visible';
            
            animationTimer = setInterval(() => {
                animationPhase++;

                // Phase 1: Curseur se déplace vers l'étiquette (depuis la position par défaut)
                if (animationPhase <= 15) {
                    const progress = animationPhase / 15;
                    const startX = 143, startY = 92; // Position par défaut selon demo-elements.css
                    const endX = labelCenterX, endY = labelCenterY;
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                // Phase 2: Clic droit sur l'étiquette
                else if (animationPhase <= 40) {
                    const clickPhase = animationPhase - 15;
                    
                    // Animation de clic
                    if (clickPhase <= 3) {
                        clickAnimation.style.visibility = 'visible';
                        clickAnimation.style.opacity = '0.6';
                        clickAnimation.style.width = (8 + clickPhase * 4) + 'px';
                        clickAnimation.style.height = (8 + clickPhase * 4) + 'px';
                        clickAnimation.style.left = (labelCenterX - 4 - clickPhase * 2) + 'px';
                        clickAnimation.style.top = (labelCenterY - 4 - clickPhase * 2) + 'px';
                    } else if (clickPhase <= 6) {
                        const shrinkPhase = clickPhase - 3;
                        clickAnimation.style.width = (20 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.height = (20 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.left = (labelCenterX - 10 + shrinkPhase * 2) + 'px';
                        clickAnimation.style.top = (labelCenterY - 10 + shrinkPhase * 2) + 'px';
                    } else {
                        clickAnimation.style.opacity = '0';
                        clickAnimation.style.visibility = 'hidden';
                    }
                    
                    // Changement de souris selon demo-elements.css
                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseRightClick.style.visibility = 'visible';
                    }
                    if (clickPhase >= 4) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseRightClick.style.visibility = 'hidden';
                    }

                    // Ouverture du menu contextuel
                    if (clickPhase >= 8) {
                        const menuProgress = Math.min(1, (clickPhase - 8) / 6);
                        contextMenu.style.visibility = 'visible';
                        contextMenu.style.opacity = menuProgress;
                        contextMenu.style.transform = `scale(${0.8 + menuProgress * 0.2})`;
                    }
                }
                // Phase 3: Menu visible, déplacement vers "Options de l'étiquette"
                else if (animationPhase <= 55) {
                    contextMenu.style.opacity = '1';
                    contextMenu.style.transform = 'scale(1)';
                    
                    // Déplacement vers "Options de l'étiquette"
                    const movePhase = animationPhase - 40;
                    if (movePhase >= 2) {
                        const progress = Math.min(1, (movePhase - 2) / 13);
                        const startX = labelCenterX, startY = labelCenterY;
                        const endX = labelCenterX + 80, endY = labelCenterY + 30; // Position relative de "Options de l'étiquette"
                        mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                        mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                    }
                }
                // Phase 4: Survol et clic sur "Options de l'étiquette"
                else if (animationPhase <= 75) {
                    const hoverPhase = animationPhase - 55;
                    
                    // Effet de survol sur "Options de l'étiquette"
                    if (hoverPhase >= 2) {
                        labelOptionsMenu.style.background = '#404040';
                        labelOptionsMenu.style.color = '#F0F0F0';
                        
                        // Animation de clic sur "Options de l'étiquette"
                        if (hoverPhase >= 3 && hoverPhase <= 13) {
                            const clickPhase = hoverPhase - 3;
                            
                            // Effet de clic sur "Options de l'étiquette" selon demo-Label-Position-Dialog.html
                            if (clickPhase >= 1 && clickPhase <= 2.5) {
                                const activateProgress = (clickPhase - 1) / 1.5;
                                const scale = 1 - (activateProgress * 0.05);
                                labelOptionsMenu.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                                labelOptionsMenu.style.color = '#ffffff';
                                labelOptionsMenu.style.transform = `scale(${scale})`;
                                labelOptionsMenu.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                            } else if (clickPhase > 2.5 && clickPhase <= 4.5) {
                                const releaseProgress = (clickPhase - 2.5) / 2;
                                const scale = 0.95 + (releaseProgress * 0.05);
                                labelOptionsMenu.style.transform = `scale(${scale})`;
                                if (releaseProgress > 0.8) {
                                    labelOptionsMenu.style.background = '#404040';
                                    labelOptionsMenu.style.color = '#F0F0F0';
                                    labelOptionsMenu.style.boxShadow = 'none';
                                }
                            } else {
                                labelOptionsMenu.style.background = '#404040';
                                labelOptionsMenu.style.color = '#F0F0F0';
                                labelOptionsMenu.style.transform = 'scale(1)';
                                labelOptionsMenu.style.boxShadow = 'none';
                            }
                            
                            // Changement de souris pour clic gauche selon demo-elements.css
                            if (clickPhase >= 2) {
                                mouseZeroClick.style.visibility = 'hidden';
                                mouseLeftClick.style.visibility = 'visible';
                            }
                            if (clickPhase >= 6) {
                                mouseZeroClick.style.visibility = 'visible';
                                mouseLeftClick.style.visibility = 'hidden';
                            }
                            
                            // Animation circulaire de clic
                            if (clickPhase <= 3) {
                                clickAnimation.style.visibility = 'visible';
                                clickAnimation.style.opacity = '0.6';
                                clickAnimation.style.width = (8 + clickPhase * 4) + 'px';
                                clickAnimation.style.height = (8 + clickPhase * 4) + 'px';
                                clickAnimation.style.left = (labelCenterX + 80 - 4 - clickPhase * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 30 - 4 - clickPhase * 2) + 'px';
                            } else if (clickPhase <= 6) {
                                const shrinkPhase = clickPhase - 3;
                                clickAnimation.style.width = (20 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.height = (20 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.left = (labelCenterX + 80 - 10 + shrinkPhase * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 30 - 10 + shrinkPhase * 2) + 'px';
                            } else {
                                clickAnimation.style.opacity = '0';
                            }
                        }
                        
                        // Ouverture du sous-menu
                        if (hoverPhase >= 6) {
                            const submenuProgress = Math.min(1, (hoverPhase - 6) / 6);
                            submenu.style.visibility = 'visible';
                            submenu.style.opacity = submenuProgress;
                            submenu.style.transform = `translateX(${-5 + submenuProgress * 5}px)`;
                        }
                    }
                }
                // Phase 5: Déplacement vers "Masquer l'étiquette"
                else if (animationPhase <= 90) {
                    const movePhase = animationPhase - 75;
                    if (movePhase <= 15) {
                        const progress = movePhase / 15;
                        const startX = labelCenterX + 80, startY = labelCenterY + 30;
                        const endX = labelCenterX + 240, endY = labelCenterY + 65; // Position relative de "Masquer l'étiquette" (2ème option du sous-menu)
                        mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                        mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                    }
                    
                    // Effet de survol sur "Masquer l'étiquette"
                    if (movePhase >= 10) {
                        hideLabelItem.style.background = '#404040';
                    }
                }
                // Phase 6: Clic sur "Masquer l'étiquette"
                else if (animationPhase <= 105) {
                    const clickPhase = animationPhase - 90;
                    
                    // Animation de clic
                    if (clickPhase <= 3) {
                        clickAnimation.style.visibility = 'visible';
                        clickAnimation.style.opacity = '0.6';
                        clickAnimation.style.width = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.height = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.left = (labelCenterX + 240 - 4 - clickPhase * 2) + 'px';
                        clickAnimation.style.top = (labelCenterY + 65 - 4 - clickPhase * 2) + 'px';
                    } else if (clickPhase <= 6) {
                        const shrinkPhase = clickPhase - 3;
                        clickAnimation.style.width = (17 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.height = (17 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.left = (labelCenterX + 240 - 10 + shrinkPhase * 2) + 'px';
                        clickAnimation.style.top = (labelCenterY + 65 - 10 + shrinkPhase * 2) + 'px';
                    } else {
                        clickAnimation.style.opacity = '0';
                    }
                    
                    // Effet de clic sur "Masquer l'étiquette" selon demo-Label-Position-Dialog.html
                    if (clickPhase >= 1 && clickPhase <= 2.5) {
                        const activateProgress = (clickPhase - 1) / 1.5;
                        const scale = 1 - (activateProgress * 0.05);
                        hideLabelItem.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                        hideLabelItem.style.color = '#ffffff';
                        hideLabelItem.style.transform = `scale(${scale})`;
                        hideLabelItem.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                    } else if (clickPhase > 2.5 && clickPhase <= 4.5) {
                        const releaseProgress = (clickPhase - 2.5) / 2;
                        const scale = 0.95 + (releaseProgress * 0.05);
                        hideLabelItem.style.transform = `scale(${scale})`;
                        if (releaseProgress > 0.8) {
                            hideLabelItem.style.background = '#404040';
                            hideLabelItem.style.color = '#F0F0F0';
                            hideLabelItem.style.boxShadow = 'none';
                        }
                    } else {
                        hideLabelItem.style.background = '#404040';
                        hideLabelItem.style.color = '#F0F0F0';
                        hideLabelItem.style.transform = 'scale(1)';
                        hideLabelItem.style.boxShadow = 'none';
                    }

                    // Changement de souris pour clic gauche selon demo-elements.css
                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseLeftClick.style.visibility = 'visible';
                    }
                    if (clickPhase >= 6) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseLeftClick.style.visibility = 'hidden';
                    }
                    
                    // Fermeture du menu après le clic
                    if (clickPhase >= 8) {
                        const closeProgress = Math.min(1, (clickPhase - 8) / 6);
                        contextMenu.style.opacity = 1 - closeProgress;
                        contextMenu.style.transform = `scale(${1 - closeProgress * 0.2})`;
                        submenu.style.opacity = 1 - closeProgress;
                        submenu.style.transform = `translateX(${-closeProgress * 5}px)`;
                    }
                }
                // Phase 7: Animation de masquage de l'étiquette
                else if (animationPhase <= 125) {
                    const hidePhase = animationPhase - 105;
                    
                    // Masquer le menu complètement
                    contextMenu.style.visibility = 'hidden';
                    submenu.style.visibility = 'hidden';
                    
                    // Animation de disparition de l'étiquette
                    if (hidePhase >= 3) {
                        const fadeProgress = Math.min(1, (hidePhase - 3) / 12);
                        
                        // Effet de pulsation avant disparition
                        if (fadeProgress < 0.3) {
                            const pulseScale = 1 + Math.sin(fadeProgress * 20) * 0.1;
                            labelBorder.style.transform = `translateX(-50%) scale(${pulseScale})`;
                            labelBorder.style.border = '3px solid #ff6b35';
                            labelBorder.style.boxShadow = '0 0 15px rgba(255, 107, 53, 0.8)';
                        } else {
                            // Disparition graduelle
                            const fadeAmount = 1 - ((fadeProgress - 0.3) / 0.7);
                            labelBorder.style.opacity = fadeAmount;
                            labelBorder.style.transform = `translateX(-50%) scale(${fadeAmount})`;
                            
                            if (fadeProgress >= 0.9) {
                                labelBorder.style.visibility = 'hidden';
                                // Changer l'état : étiquette maintenant masquée
                                isLabelVisible = false;
                            }
                        }
                    }
                }
                // Phase 8: Déplacement vers la poignée pour réouvrir le menu
                else if (animationPhase <= 140) {
                    const movePhase = animationPhase - 125;
                    
                    // Étiquette reste masquée
                    labelBorder.style.visibility = 'hidden';
                    mouseCursor.style.visibility = 'visible';
                    
                    // Déplacement vers la poignée
                    if (movePhase <= 15) {
                        const progress = movePhase / 15;
                        const startX = labelCenterX + 240, startY = labelCenterY + 65; // Position de "Masquer l'étiquette"
                        const endX = 244, endY = 133; // Position de la poignée selon demo-elements.css
                        mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                        mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                    }
                }
                // Phase 9: Clic sur la poignée pour réouvrir le menu
                else if (animationPhase <= 145) {
                    const clickPhase = animationPhase - 140;
                    
                    // Animation de clic sur la poignée (clic quasi-immédiat)
                    if (clickPhase <= 2) {
                        clickAnimation.style.visibility = 'visible';
                        clickAnimation.style.opacity = '0.6';
                        clickAnimation.style.width = (8 + clickPhase * 4) + 'px';
                        clickAnimation.style.height = (8 + clickPhase * 4) + 'px';
                        clickAnimation.style.left = (244 - 4 - clickPhase * 2) + 'px';
                        clickAnimation.style.top = (133 - 4 - clickPhase * 2) + 'px';
                    } else if (clickPhase <= 4) {
                        const shrinkPhase = clickPhase - 2;
                        clickAnimation.style.width = (16 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.height = (16 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.left = (244 - 8 + shrinkPhase * 2) + 'px';
                        clickAnimation.style.top = (133 - 8 + shrinkPhase * 2) + 'px';
                    } else {
                        clickAnimation.style.opacity = '0';
                    }
                    
                    // Changement de souris pour clic droit (plus rapide)
                    if (clickPhase >= 1) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseRightClick.style.visibility = 'visible';
                    }
                    if (clickPhase >= 3) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseRightClick.style.visibility = 'hidden';
                    }
                    
                    // Réouverture du menu (plus rapide)
                    if (clickPhase >= 2) {
                        const menuProgress = Math.min(1, (clickPhase - 2) / 2);
                        contextMenu.style.visibility = 'visible';
                        contextMenu.style.opacity = menuProgress;
                        contextMenu.style.transform = `scale(${0.8 + menuProgress * 0.2})`;
                    }
                }
                // Phase 10: Menu visible, déplacement vers "Options de l'étiquette"
                else if (animationPhase <= 160) {
                    const movePhase = animationPhase - 145;
                    
                    contextMenu.style.opacity = '1';
                    contextMenu.style.transform = 'scale(1)';
                    
                    // Déplacement vers "Options de l'étiquette"
                    if (movePhase <= 15) {
                        const progress = movePhase / 15;
                        const startX = 244, startY = 133; // Position de la poignée
                        const endX = labelCenterX + 80, endY = labelCenterY + 30; // Position de "Options de l'étiquette"
                        mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                        mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                    }
                }
                // Phase 11: Clic sur "Options de l'étiquette" pour ouvrir le sous-menu
                else if (animationPhase <= 175) {
                    const clickPhase = animationPhase - 160;
                    
                    // Effet de survol sur "Options de l'étiquette"
                    if (clickPhase >= 2) {
                        labelOptionsMenu.style.background = '#404040';
                        labelOptionsMenu.style.color = '#F0F0F0';
                        
                        // Animation de clic
                        if (clickPhase >= 3 && clickPhase <= 13) {
                            const clickPhaseInner = clickPhase - 3;
                            
                            // Effet de clic bleu
                            if (clickPhaseInner >= 1 && clickPhaseInner <= 2.5) {
                                const activateProgress = (clickPhaseInner - 1) / 1.5;
                                const scale = 1 - (activateProgress * 0.05);
                                labelOptionsMenu.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                                labelOptionsMenu.style.color = '#ffffff';
                                labelOptionsMenu.style.transform = `scale(${scale})`;
                                labelOptionsMenu.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                            } else if (clickPhaseInner > 2.5 && clickPhaseInner <= 4.5) {
                                const releaseProgress = (clickPhaseInner - 2.5) / 2;
                                const scale = 0.95 + (releaseProgress * 0.05);
                                labelOptionsMenu.style.transform = `scale(${scale})`;
                                if (releaseProgress > 0.8) {
                                    labelOptionsMenu.style.background = '#404040';
                                    labelOptionsMenu.style.color = '#F0F0F0';
                                    labelOptionsMenu.style.boxShadow = 'none';
                                }
                            } else {
                                labelOptionsMenu.style.background = '#404040';
                                labelOptionsMenu.style.color = '#F0F0F0';
                                labelOptionsMenu.style.transform = 'scale(1)';
                                labelOptionsMenu.style.boxShadow = 'none';
                            }
                            
                            // Changement de souris
                            if (clickPhaseInner >= 2) {
                                mouseZeroClick.style.visibility = 'hidden';
                                mouseLeftClick.style.visibility = 'visible';
                            }
                            if (clickPhaseInner >= 6) {
                                mouseZeroClick.style.visibility = 'visible';
                                mouseLeftClick.style.visibility = 'hidden';
                            }
                            
                            // Animation circulaire
                            if (clickPhaseInner <= 3) {
                                clickAnimation.style.visibility = 'visible';
                                clickAnimation.style.opacity = '0.6';
                                clickAnimation.style.width = (8 + clickPhaseInner * 4) + 'px';
                                clickAnimation.style.height = (8 + clickPhaseInner * 4) + 'px';
                                clickAnimation.style.left = (labelCenterX + 80 - 4 - clickPhaseInner * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 30 - 4 - clickPhaseInner * 2) + 'px';
                            } else if (clickPhaseInner <= 6) {
                                const shrinkPhase = clickPhaseInner - 3;
                                clickAnimation.style.width = (20 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.height = (20 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.left = (labelCenterX + 80 - 10 + shrinkPhase * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 30 - 10 + shrinkPhase * 2) + 'px';
                            } else {
                                clickAnimation.style.opacity = '0';
                            }
                        }
                        
                        // Ouverture du sous-menu
                        if (clickPhase >= 6) {
                            const submenuProgress = Math.min(1, (clickPhase - 6) / 6);
                            submenu.style.visibility = 'visible';
                            submenu.style.opacity = submenuProgress;
                            submenu.style.transform = `translateX(${-5 + submenuProgress * 5}px)`;
                            
                            // Mettre à jour l'état de l'option quand le sous-menu s'ouvre
                            if (submenuProgress >= 0.5) {
                                updateLabelOptionState();
                            }
                        }
                    }
                }
                // Phase 12: Déplacement vers "Afficher l'étiquette"
                else if (animationPhase <= 190) {
                    const movePhase = animationPhase - 175;
                    
                    if (movePhase <= 15) {
                        const progress = movePhase / 15;
                        const startX = labelCenterX + 80, startY = labelCenterY + 30;
                        const endX = labelCenterX + 240, endY = labelCenterY + 65; // Position de "Afficher l'étiquette"
                        mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                        mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                    }
                }
                // Phase 13: Clic sur "Afficher l'étiquette"
                else if (animationPhase <= 205) {
                    const clickPhase = animationPhase - 190;
                    
                    // Effet de survol sur "Afficher l'étiquette"
                    if (clickPhase >= 2) {
                        hideLabelItem.style.background = '#404040';
                        hideLabelItem.style.color = '#F0F0F0';
                        
                        // Animation de clic
                        if (clickPhase >= 3 && clickPhase <= 13) {
                            const clickPhaseInner = clickPhase - 3;
                            
                            // Effet de clic bleu
                            if (clickPhaseInner >= 1 && clickPhaseInner <= 2.5) {
                                const activateProgress = (clickPhaseInner - 1) / 1.5;
                                const scale = 1 - (activateProgress * 0.05);
                                hideLabelItem.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                                hideLabelItem.style.color = '#ffffff';
                                hideLabelItem.style.transform = `scale(${scale})`;
                                hideLabelItem.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                            } else if (clickPhaseInner > 2.5 && clickPhaseInner <= 4.5) {
                                const releaseProgress = (clickPhaseInner - 2.5) / 2;
                                const scale = 0.95 + (releaseProgress * 0.05);
                                hideLabelItem.style.transform = `scale(${scale})`;
                                if (releaseProgress > 0.8) {
                                    hideLabelItem.style.background = '#404040';
                                    hideLabelItem.style.color = '#F0F0F0';
                                    hideLabelItem.style.boxShadow = 'none';
                                }
                            } else {
                                hideLabelItem.style.background = '#404040';
                                hideLabelItem.style.color = '#F0F0F0';
                                hideLabelItem.style.transform = 'scale(1)';
                                hideLabelItem.style.boxShadow = 'none';
                            }
                            
                            // Changement de souris
                            if (clickPhaseInner >= 2) {
                                mouseZeroClick.style.visibility = 'hidden';
                                mouseLeftClick.style.visibility = 'visible';
                            }
                            if (clickPhaseInner >= 6) {
                                mouseZeroClick.style.visibility = 'visible';
                                mouseLeftClick.style.visibility = 'hidden';
                            }
                            
                            // Animation circulaire
                            if (clickPhaseInner <= 3) {
                                clickAnimation.style.visibility = 'visible';
                                clickAnimation.style.opacity = '0.6';
                                clickAnimation.style.width = (8 + clickPhaseInner * 3) + 'px';
                                clickAnimation.style.height = (8 + clickPhaseInner * 3) + 'px';
                                clickAnimation.style.left = (labelCenterX + 240 - 4 - clickPhaseInner * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 65 - 4 - clickPhaseInner * 2) + 'px';
                            } else if (clickPhaseInner <= 6) {
                                const shrinkPhase = clickPhaseInner - 3;
                                clickAnimation.style.width = (17 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.height = (17 - shrinkPhase * 3) + 'px';
                                clickAnimation.style.left = (labelCenterX + 240 - 10 + shrinkPhase * 2) + 'px';
                                clickAnimation.style.top = (labelCenterY + 65 - 10 + shrinkPhase * 2) + 'px';
                            } else {
                                clickAnimation.style.opacity = '0';
                            }
                        }
                        
                        // Fermeture du menu après le clic
                        if (clickPhase >= 6) {
                            const closeProgress = Math.min(1, (clickPhase - 6) / 6);
                            contextMenu.style.opacity = 1 - closeProgress;
                            submenu.style.opacity = 1 - closeProgress;
                            if (closeProgress >= 1) {
                                contextMenu.style.visibility = 'hidden';
                                submenu.style.visibility = 'hidden';
                            }
                        }
                    }
                }
                // Phase 14: Animation de réapparition de l'étiquette
                else if (animationPhase <= 220) {
                    const showPhase = animationPhase - 205;
                    
                    // Animation de réapparition de l'étiquette
                    if (showPhase >= 3) {
                        const fadeProgress = Math.min(1, (showPhase - 3) / 12);
                        
                        // Effet de pulsation avant réapparition
                        if (fadeProgress < 0.3) {
                            const pulseScale = 0.5 + Math.sin(fadeProgress * 20) * 0.1;
                            labelBorder.style.transform = `translateX(-50%) scale(${pulseScale})`;
                            labelBorder.style.border = '3px solid #00ff88';
                            labelBorder.style.boxShadow = '0 0 15px rgba(0, 255, 136, 0.8)';
                        } else {
                            // Réapparition graduelle
                            const fadeAmount = (fadeProgress - 0.3) / 0.7;
                            labelBorder.style.opacity = fadeAmount;
                            labelBorder.style.transform = `translateX(-50%) scale(${fadeAmount})`;
                            
                            if (fadeProgress >= 0.1) {
                                labelBorder.style.visibility = 'visible';
                            }
                            
                            if (fadeProgress >= 0.9) {
                                labelBorder.style.border = '2px solid white';
                                labelBorder.style.boxShadow = 'none';
                                // Changer l'état : étiquette maintenant visible
                                isLabelVisible = true;
                            }
                        }
                    }
                }
                // Phase 15: Pause finale avant reset
                else if (animationPhase <= 235) {
                    // Étiquette visible, pause avant redémarrage
                    labelBorder.style.visibility = 'visible';
                    labelBorder.style.opacity = '1';
                    labelBorder.style.transform = 'translateX(-50%) scale(1)';
                    labelBorder.style.border = '2px solid white';
                    labelBorder.style.boxShadow = 'none';
                    mouseCursor.style.visibility = 'hidden';
                }
                // Phase 16: Reset pour la boucle
                else {
                    // Reset de tous les éléments
                    animationPhase = 0;
                    
                    // Reset de la position du curseur (position par défaut)
                    mouseCursor.style.left = '143px';
                    mouseCursor.style.top = '92px';
                    mouseCursor.style.visibility = 'visible';
                    
                    // Reset de l'étiquette
                    labelBorder.style.visibility = 'visible';
                    labelBorder.style.opacity = '1';
                    labelBorder.style.transform = 'translateX(-50%) scale(1)';
                    labelBorder.style.border = '2px solid white';
                    labelBorder.style.boxShadow = 'none';
                    
                    // Reset du menu
                    contextMenu.style.visibility = 'hidden';
                    contextMenu.style.opacity = '0';
                    contextMenu.style.transform = 'scale(0.8)';
                    
                    // Reset du sous-menu
                    submenu.style.visibility = 'hidden';
                    submenu.style.opacity = '0';
                    submenu.style.transform = 'translateX(-5px)';
                    
                    // Reset des effets de survol
                    labelOptionsMenu.style.background = 'transparent';
                    labelOptionsMenu.style.color = '#F0F0F0';
                    labelOptionsMenu.style.transform = 'scale(1)';
                    labelOptionsMenu.style.boxShadow = 'none';
                    hideLabelItem.style.background = 'transparent';
                    hideLabelItem.style.color = '#F0F0F0';
                    hideLabelItem.style.transform = 'scale(1)';
                    hideLabelItem.style.boxShadow = 'none';
                    
                    // Reset de l'état et de l'option
                    isLabelVisible = true;
                    updateLabelOptionState();
                    
                    // Reset de l'animation de clic
                    clickAnimation.style.visibility = 'hidden';
                    clickAnimation.style.opacity = '0';
                    
                    // Reset de la souris selon demo-elements.css
                    mouseZeroClick.style.visibility = 'visible';
                    mouseRightClick.style.visibility = 'hidden';
                    mouseLeftClick.style.visibility = 'hidden';
                }
            }, 80); // Ralenti légèrement pour une meilleure visibilité
        }

        // Démarrer l'animation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            if (canvas && labelBorder) {
            const canvasRect = canvas.getBoundingClientRect();
            const labelRect = labelBorder.getBoundingClientRect();
                const bubbleRect = document.querySelector('.dynamic-border').getBoundingClientRect();
                
                // Position de l'étiquette
            labelCenterX = Math.round(labelRect.left - canvasRect.left + labelRect.width / 2);
            labelCenterY = Math.round(labelRect.top - canvasRect.top + labelRect.height / 2);
                
                // Position du centre de la bulle
                bubbleCenterX = Math.round(bubbleRect.left - canvasRect.left + bubbleRect.width / 2);
                bubbleCenterY = Math.round(bubbleRect.top - canvasRect.top + bubbleRect.height / 2);
                
                console.log('Label center:', labelCenterX, labelCenterY);
                console.log('Bubble center:', bubbleCenterX, bubbleCenterY);
            }
            
            // Initialiser l'état de la sous-option
            updateLabelOptionState();
            
            setTimeout(startAnimation, 1000);
        });
    </script>
</body>
</html>
