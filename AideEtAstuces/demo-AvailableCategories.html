<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©monstration Cat√©gories - MyCustomDesk</title>
    <link rel="stylesheet" href="demo-elements.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: transparent;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* Styles pour la d√©monstration */
        .demo-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }

        .demo-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: stretch;
        }

        .demo-messages-panel {
            height: 100%;
            min-height: 550px;
            background: transparent;
            overflow-y: auto;
        }

        .demo-left-panel {
            flex: 1;
            min-width: 0;
        }

        .demo-right-panel {
            flex: 0 0 650px;
        }

        /* Styles pour la bulle de d√©monstration */
        .demo-bubble-container {
            width: 100%;
            height: 100%;
            min-width: 0;
            min-height: 400px;
            margin: 0;
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .demo-bubble-border {
            border: 2px solid #d1d1d1;
            border-radius: 15px;
            padding: 6px;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .demo-bubble-header {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            margin-bottom: 6px;
            min-height: 0;
        }

        .demo-bubble-title {
            font-size: 20px;
            font-weight: bold;
            color: #000000;
        }

        .demo-bubble-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 6px;
            min-height: 0;
            overflow: hidden;
        }

        .demo-bubble-canvas {
            position: relative;
            background: #2D2D2D;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            overflow: visible;
        }

        /* Ajustement de la bulle pour les nouvelles dimensions */
        .demo-bubble-canvas .dynamic-border {
            position: absolute;
            border: 2px solid white;
            background: #2D2D30;
            border-radius: 6px;
            width: 400px;
            height: 160px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        /* Ajustement de l'√©tiquette pour la nouvelle bulle */
        .demo-bubble-canvas .label-border {
            position: absolute;
            background: #2D2D30;
            border: 1px solid white;
            border-radius: 3px;
            padding: 3px 6px;
            height: 20px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto;
            min-width: fit-content;
            margin-top: -100px; /* Positionner au-dessus de la bulle */
        }

        /* Ajustement de la poign√©e pour la nouvelle bulle */
        .demo-bubble-canvas .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: white;
            border: 1px solid black;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            margin-left: 198px; /* Positionner √† droite de la bulle */
            margin-top: 78px; /* Positionner en bas de la bulle */
            z-index: 999;
            transition: all 0.3s ease;
        }

        .demo-progress-window {
            width: 100%;
            background: #ffffff;
            border: 2px solid #c0c0c0;
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: block;
        }

        .demo-progress-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .demo-progress-header {
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .demo-progress-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d2d30;
            margin-bottom: 4px;
        }

        .demo-progress-subtitle {
            font-size: 12px;
            color: #666666;
        }

        .demo-progress-body {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .demo-progress-instruction {
            font-size: 13px;
            color: #2d2d30;
            line-height: 1.4;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #0078d4;
        }

        .demo-progress-bar-container {
            background: #e0e0e0;
            border-radius: 8px;
            height: 16px;
            overflow: hidden;
        }

        .demo-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0078d4, #106ebe);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .demo-progress-controls {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .demo-button {
            padding: 6px 12px;
            border: 2px solid #0078d4;
            background: #0078d4;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            background: #106ebe;
            border-color: #106ebe;
        }

        .demo-button.secondary {
            background: white;
            color: #0078d4;
        }

        .demo-button.secondary:hover {
            background: #f0f8ff;
        }

        .demo-button:disabled {
            background: #cccccc;
            border-color: #cccccc;
            cursor: not-allowed;
        }

        .main-container {
            width: 100%;
            height: 550px;
            min-width: 0;
            margin: 0;
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .main-border {
            border: 2px solid #d1d1d1;
            border-radius: 15px;
            padding: 6px;
            background: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-grid {
            flex: 1;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 8px;
            margin: 6px;
            min-height: 0;
            overflow: hidden;
        }

        /* En-t√™te */
        .header {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            margin-bottom: 6px;
            min-height: 0;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            color: #000000;
        }

        .close-button {
            width: 30px;
            height: 30px;
            border: none;
            background: transparent;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-button:hover {
            background: #e5e5e5;
        }

        /* Contenu principal */
        .main-content {
            display: grid;
            grid-template-columns: 220px 3px 1fr;
            gap: 0;
            margin-bottom: 6px;
            min-height: 0;
            overflow: hidden;
        }

        /* Volet des cat√©gories */
        .categories-panel {
            width: 220px;
            background: #f0f0f0;
            border-radius: 6px;
            padding: 8px 6px;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .categories-title {
            font-size: 12px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 4px;
            flex-shrink: 0;
            text-align: center;
        }

        .categories-list {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .category-button {
            width: 100%;
            padding: 6px 8px;
            margin: 2px 0;
            border: none;
            background: transparent;
            text-align: center;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
            color: #000000;
            transition: all 0.2s;
            line-height: 1.2;
        }

        .category-button:hover {
            background: #e0e0e0;
        }

        .category-button.selected {
            background: #005ea2;
            color: white;
            font-weight: bold;
        }

        /* S√©parateur */
        .splitter {
            background: #d1d1d1;
            width: 1px;
            cursor: col-resize;
        }

        /* Zone des images */
        .images-panel {
            background: #f0f0f0;
            border-radius: 6px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .current-category-title {
            font-size: 16px;
            font-weight: bold;
            color: #000000;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .images-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
            min-height: 0;
        }

        .images-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 0;
        }

        .image-button {
            width: 120px;
            height: 90px;
            border: 2px solid transparent;
            background: transparent;
            cursor: pointer;
            border-radius: 3px;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .image-button:hover {
            border-color: #cccccc;
        }

        .image-button.selected {
            border: 3px solid #005ea2;
        }

        .image-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Barre d'√©tat */
        .status-bar {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            min-height: 0;
            flex-shrink: 0;
        }

        .status-text {
            color: #666666;
            font-size: 12px;
        }

        .action-buttons {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .action-button {
            height: 26px;
            min-width: 120px;
            border: 1px solid #cccccc;
            background: #ffffff;
            cursor: pointer;
            border-radius: 3px;
            font-size: 11px;
            padding: 0 12px;
            white-space: nowrap;
        }

        .action-button:hover {
            background: #f0f0f0;
        }

        .action-button:disabled {
            background: #f5f5f5;
            color: #999999;
            cursor: not-allowed;
        }

        .action-button.primary {
            background: #005ea2;
            color: white;
            border-color: #005ea2;
            min-width: 100px;
        }

        .action-button.primary:hover:not(:disabled) {
            background: #004080;
        }

        /* Scrollbar personnalis√©e */
        .categories-list::-webkit-scrollbar,
        .images-container::-webkit-scrollbar {
            width: 8px;
        }

        .categories-list::-webkit-scrollbar-track,
        .images-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .categories-list::-webkit-scrollbar-thumb,
        .images-container::-webkit-scrollbar-thumb {
            background: #cccccc;
            border-radius: 4px;
        }

        .categories-list::-webkit-scrollbar-thumb:hover,
        .images-container::-webkit-scrollbar-thumb:hover {
            background: #999999;
        }

        /* Styles pour la d√©monstration */
        .demo-highlight {
            animation: demoPulse 1s ease-in-out infinite;
            box-shadow: 0 0 10px #0078d4 !important;
        }

        @keyframes demoPulse {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(0, 120, 212, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(0, 120, 212, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(0, 120, 212, 0.7);
            }
        }

        @keyframes demoPulseOrange {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(255, 107, 53, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
        }

        .category-button.demo-highlight {
            background: #0078d4 !important;
            color: white !important;
            font-weight: bold !important;
        }

        .category-button.demo-highlight-orange {
            animation: demoPulseOrange 1s ease-in-out infinite;
            background: #ff6b35 !important;
            color: #ffffff !important;
            font-weight: bold !important;
            box-shadow: 0 0 10px #ff6b35 !important;
        }

        .image-button.demo-highlight {
            border: 3px solid #0078d4 !important;
            box-shadow: 0 0 15px #0078d4 !important;
        }

        /* Styles pour la mise en surbrillance des boutons */
        .button-highlight {
            position: absolute;
            border: 3px solid #ff6b35;
            border-radius: 4px;
            background: rgba(255, 107, 53, 0.1);
            pointer-events: none;
            z-index: 999;
            animation: demoPulseOrange 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(255, 107, 53, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
        }

        /* Styles pour les messages explicatifs */
        .demo-message {
            position: relative;
            background: #ffffff;
            color: #2d2d30;
            padding: 14px 16px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            margin: 10px auto;
            max-width: 650px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            border: 1px solid #e5e5e5;
        }

        .demo-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .demo-message .message-title {
            margin: 0 0 10px 0;
            font-size: 20px;
            font-weight: bold;
            color: #2d2d30;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e5e5;
        }

        .demo-message .message-section {
            margin: 8px 0;
            padding: 10px 12px;
            background: #f8f9fb;
            border-radius: 8px;
            border-left: 4px solid #cfd8dc;
        }

        .demo-message .section-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 6px 0;
            color: #2d2d30;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .demo-message .section-content {
            font-size: 15px;
            line-height: 1.45;
            color: #333333;
            margin: 0;
        }

        .demo-message .action-required {
            background: rgba(255, 107, 53, 0.2);
            border-left-color: #ff6b35;
            position: relative;
        }

        .demo-message .action-required::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px solid #ff6b35;
            border-radius: 10px;
            animation: actionPulse 1s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes actionPulse {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(255, 107, 53, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
        }

        .demo-message .tip-section {
            background: #fff8e1;
            border-left-color: #ffcc80;
        }

        .demo-message .validation-button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(40, 167, 69, 0.28);
        }

        .demo-message .validation-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .demo-message .validation-button:active {
            transform: translateY(0);
        }

        .demo-message .close-btn {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: #333333;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-message .close-btn:hover {
            background: rgba(0,0,0,0.06);
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Fen√™tre de progression de d√©monstration -->
        <div class="demo-progress-window" id="demoProgressWindow">
            <div class="demo-progress-content">
                <div class="demo-progress-header">
                    <div class="demo-progress-title">üìö D√©monstration : Guide d'utilisation complet de la Biblioth√®que</div>
                    <div class="demo-progress-subtitle">Guide interactif pour explorer les cat√©gories, puis s√©lectionner et appliquer un fond d'√©cran et un fond de bulle</div>
                </div>
                
                <div class="demo-progress-body">
                    <div class="demo-progress-instruction" id="demoInstruction">
                        Cette d√©monstration vous apprend √† parcourir les cat√©gories de la biblioth√®que d'images, puis √† s√©lectionner et appliquer un fond d'√©cran ainsi qu'un fond de bulle.
                    </div>
                    
                    <div class="demo-progress-bar-container">
                        <div class="demo-progress-bar" id="progressBar"></div>
                    </div>
                    
                    <div class="demo-progress-controls">
                        <button class="demo-button secondary" id="prevStepBtn" disabled>√âtape pr√©c√©dente</button>
                        <button class="demo-button" id="startDemo">D√©marrer</button>
                        <button class="demo-button secondary" id="stopDemo" disabled>Arr√™ter</button>
                        <button class="demo-button secondary" id="closeDemo">Fermer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disposition en trois colonnes -->
        <div class="demo-layout">
            <!-- Panneau gauche : Biblioth√®que -->
            <div class="demo-left-panel">
                <div class="main-container" id="libraryWindow">
            <div class="main-border">
            <div class="content-grid">
                <!-- En-t√™te -->
                <div class="header">
                    <div class="title">Biblioth√®que d'Images</div>
                    <button class="close-button" onclick="closeWindow()">‚úï</button>
                </div>

                <!-- Contenu principal -->
                <div class="main-content">
                    <!-- Volet des cat√©gories -->
                    <div class="categories-panel">
                        <div class="categories-title">Cat√©gories</div>
                        <div class="categories-list" id="categoriesList">
                            <button class="category-button selected" data-category="3d">3D</button>
                            <button class="category-button" data-category="abstract">Abstract</button>
                            <button class="category-button" data-category="bricks">Bricks</button>
                            <button class="category-button" data-category="floral">Floral</button>
                            <button class="category-button" data-category="forest">Forest</button>
                            <button class="category-button" data-category="fruity">Fruity</button>
                            <button class="category-button" data-category="landscape">Landscape</button>
                            <button class="category-button" data-category="nature">Nature</button>
                            <button class="category-button" data-category="sea">Sea</button>
                            <button class="category-button" data-category="village">Village</button>
                            <button class="category-button" data-category="marble">Marble</button>
                            <button class="category-button" data-category="stone">Stone</button>
                        </div>
                    </div>

                    <!-- S√©parateur -->
                    <div class="splitter"></div>

                    <!-- Zone des images -->
                    <div class="images-panel">
                        <div class="current-category-title" id="currentCategoryTitle">3D</div>
                        <div class="images-container">
                            <div class="images-grid" id="imagesGrid">
                                <!-- Les images seront g√©n√©r√©es par JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Barre d'√©tat -->
                <div class="status-bar">
                    <div class="status-text" id="statusText">3D - 12 image(s)</div>
                    <div class="action-buttons">
                        <button class="action-button" id="applyWallpaperBtn" disabled>Appliquer comme fond d'√©cran</button>
                        <button class="action-button primary" id="selectBtn" disabled>S√©lectionner</button>
                        <button class="action-button" id="cancelBtn">Annuler</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
            </div>

            <!-- Panneau droit : Bulle de d√©monstration -->
            <div class="demo-right-panel">
                <div class="demo-bubble-container">
                    <div class="demo-bubble-border">
                        <!-- En-t√™te -->
                        <div class="demo-bubble-header">
                            <div class="demo-bubble-title">Bureau</div>
                        </div>

                        <!-- Contenu principal -->
                        <div class="demo-bubble-content">
                            <div class="demo-bubble-canvas">
                                <!-- Bordure dynamique (bulle) -->
                                <div class="dynamic-border" id="demoBubble"></div>

                                <!-- √âtiquette centr√©e automatiquement -->
                                <div class="label-border">
                                    <div class="label-text" id="bubbleLabelText">Ma Bulle</div>
                                </div>

                                <!-- Poign√©e de redimensionnement -->
                                <div class="resize-handle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panneau messages (colonne droite) -->
            <div class="demo-messages-panel">
                <!-- Zone des messages explicatifs -->
                <div id="messagesContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour la d√©monstration
        let demoRunning = false;
        let currentStep = 0;
        let categoryAnimationActive = false;
        let navigationAnimationActive = false;
        let demoSteps = [
            "Cliquez sur une cat√©gorie dans la liste de gauche",
            "Explorez les diff√©rentes cat√©gories disponibles",
            "S√©lectionnez une image pour voir les options"
        ];

        // Donn√©es de d√©monstration avec 12 cat√©gories (3D √† Stone)
        const categories = {
            '3d': { name: '3D', count: 24, colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#D7BDE2', '#A9DFBF', '#F9E79F', '#AED6F1', '#D5DBDB', '#FADBD8', '#D1F2EB', '#FCF3CF', '#E8DAEF', '#D5DBDB'] },
            'abstract': { name: 'Abstract', count: 18, colors: ['#E74C3C', '#9B59B6', '#3498DB', '#1ABC9C', '#F39C12', '#E67E22', '#95A5A6', '#34495E', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39'] },
            'bricks': { name: 'Bricks', count: 15, colors: ['#8B4513', '#A0522D', '#CD853F', '#D2691E', '#B22222', '#DC143C', '#B8860B', '#DAA520', '#CD853F', '#DEB887', '#F4A460', '#D2B48C', '#BC8F8F', '#F0E68C', '#DDA0DD'] },
            'floral': { name: 'Floral', count: 22, colors: ['#FF69B4', '#FF1493', '#FFB6C1', '#FFC0CB', '#DDA0DD', '#DA70D6', '#BA55D3', '#9370DB', '#8A2BE2', '#9400D3', '#9932CC', '#8B008B', '#800080', '#4B0082', '#6A5ACD', '#7B68EE', '#9370DB', '#8A2BE2', '#9400D3', '#9932CC', '#8B008B', '#800080'] },
            'forest': { name: 'Forest', count: 20, colors: ['#228B22', '#32CD32', '#00FF00', '#7CFC00', '#ADFF2F', '#9ACD32', '#6B8E23', '#556B2F', '#2E8B57', '#3CB371', '#20B2AA', '#48D1CC', '#40E0D0', '#00CED1', '#5F9EA0', '#4682B4', '#6495ED', '#7B68EE', '#9370DB', '#8A2BE2'] },
            'fruity': { name: 'Fruity', count: 16, colors: ['#FF4500', '#FF6347', '#FF7F50', '#FFA500', '#FFD700', '#FFFF00', '#ADFF2F', '#7FFF00', '#00FF7F', '#00FA9A', '#40E0D0', '#00CED1', '#1E90FF', '#4169E1', '#0000FF', '#8A2BE2'] },
            'landscape': { name: 'Landscape', count: 25, colors: ['#87CEEB', '#B0E0E6', '#ADD8E6', '#87CEFA', '#00BFFF', '#1E90FF', '#4169E1', '#0000FF', '#0000CD', '#00008B', '#191970', '#483D8B', '#6A5ACD', '#7B68EE', '#9370DB', '#8A2BE2', '#9400D3', '#9932CC', '#8B008B', '#800080', '#4B0082', '#2F4F4F', '#708090', '#778899', '#B0C4DE'] },
            'nature': { name: 'Nature', count: 28, colors: ['#90EE90', '#98FB98', '#8FBC8F', '#9ACD32', '#ADFF2F', '#7FFF00', '#7CFC00', '#00FF00', '#32CD32', '#00FA9A', '#00FF7F', '#3CB371', '#2E8B57', '#228B22', '#006400', '#556B2F', '#6B8E23', '#808000', '#BDB76B', '#F0E68C', '#EEE8AA', '#F5DEB3', '#DEB887', '#D2B48C', '#BC8F8F', '#F4A460', '#D2691E', '#CD853F'] },
            'sea': { name: 'Sea', count: 19, colors: ['#4169E1', '#0000FF', '#0000CD', '#00008B', '#191970', '#483D8B', '#6A5ACD', '#7B68EE', '#9370DB', '#8A2BE2', '#9400D3', '#9932CC', '#8B008B', '#800080', '#4B0082', '#2F4F4F', '#708090', '#778899', '#B0C4DE'] },
            'village': { name: 'Village', count: 14, colors: ['#8B4513', '#A0522D', '#CD853F', '#D2691E', '#B22222', '#DC143C', '#B8860B', '#DAA520', '#CD853F', '#DEB887', '#F4A460', '#D2B48C', '#BC8F8F', '#F0E68C'] },
            'marble': { name: 'Marble', count: 12, colors: ['#F5F5DC', '#FFFAF0', '#FDF5E6', '#FAF0E6', '#F5DEB3', '#DEB887', '#D2B48C', '#BC8F8F', '#F4A460', '#D2691E', '#CD853F', '#A0522D'] },
            'stone': { name: 'Stone', count: 17, colors: ['#A9A9A9', '#C0C0C0', '#D3D3D3', '#DCDCDC', '#F5F5F5', '#696969', '#808080', '#778899', '#708090', '#2F4F4F', '#483D8B', '#6A5ACD', '#7B68EE', '#9370DB', '#8A2BE2', '#9400D3', '#9932CC'] }
        };

        let currentCategory = '3d';
        let selectedImageIndex = -1;
        let selectedImageColor = null;
        let userSelectedCategories = [];

        // Fonction pour g√©n√©rer une image SVG avec une couleur sp√©cifique
        function generateColoredImage(color, index) {
            const svg = `
                <svg width="80" height="60" viewBox="0 0 80 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="80" height="60" fill="#F0F0F0" stroke="#CCCCCC"/>
                    <svg x="3" y="3" width="74" height="54" viewBox="0 0 74 54">
                        <rect width="74" height="54" fill="${color}"/>
                        <svg x="25" y="15" width="24" height="24" viewBox="0 -960 960 960" fill="#e3e3e3">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h480L570-480 450-320l-90-120-120 160Zm-40 80v-560 560Z"/>
                        </svg>
                    </svg>
                </svg>
            `;
            return 'data:image/svg+xml;base64,' + btoa(svg);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeCategories();
            loadImagesForCategory(currentCategory);
        });

        function setupEventListeners() {
            document.getElementById('startDemo').addEventListener('click', startDemo);
            document.getElementById('stopDemo').addEventListener('click', stopDemo);
            document.getElementById('closeDemo').addEventListener('click', closeDemo);
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.addEventListener('click', goToPreviousStep);
        }

        function startDemo() {
            if (demoRunning) return;
            
            demoRunning = true;
            currentStep = 0;
            
            // Mettre √† jour les boutons
            document.getElementById('startDemo').disabled = true;
            document.getElementById('stopDemo').disabled = false;
            document.getElementById('prevStepBtn').disabled = true;
            
            // Commencer la d√©monstration avec un message et un bouton Ok pour continuer
            setTimeout(() => {
                showStructuredMessage("üéØ D√©monstration d√©marr√©e", [
                    {
                        type: 'info',
                        icon: 'üìñ',
                        title: 'Bienvenue',
                        content: "Nous allons explorer les cat√©gories disponibles dans la biblioth√®que d'images. Regardez les √©l√©ments mis en surbrillance !"
                    }
                ], 'continueFromStartMessage()');
            }, 300);
        }

        function stopDemo() {
            demoRunning = false;
            completeDemo();
        }

        function resetDemo() {
            demoRunning = false;
            currentStep = 0;
            
            // Arr√™ter toutes les animations
            categoryAnimationActive = false;
            navigationAnimationActive = false;
            
            // R√©initialiser les boutons
            document.getElementById('startDemo').disabled = false;
            document.getElementById('stopDemo').disabled = true;
            document.getElementById('prevStepBtn').disabled = true;
            
            // R√©initialiser la progression
            updateProgress(0);
            updateInstruction("Cette d√©monstration va vous montrer comment explorer les diff√©rentes cat√©gories disponibles dans la biblioth√®que d'images.");
            
            // R√©initialiser la s√©lection
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('selected', 'demo-highlight');
            });
            document.querySelector('[data-category="3d"]').classList.add('selected');
            currentCategory = '3d';
            selectedImageIndex = -1;
            selectedImageColor = null;
            userSelectedCategories = [];
            loadImagesForCategory('3d');
            
            // R√©initialiser la bulle de d√©monstration
            resetDemoBubble();
            
            // Fermer tous les messages
            closeAllMessages();
            
            // R√©initialiser le fond d'√©cran
            document.body.style.backgroundColor = '';
        }

        function closeDemo() {
            // R√©initialiser le fond d'√©cran avant de fermer
            document.body.style.backgroundColor = '';
            
            // R√©initialiser le fond du canvas
            const demoCanvas = document.querySelector('.demo-bubble-canvas');
            if (demoCanvas) {
                demoCanvas.style.backgroundColor = '#2D2D2D';
            }
            
            window.close();
        }

        function highlightCategories() {
            updateInstruction("√âtape 1 : Voici la liste des cat√©gories disponibles. Cliquez sur une cat√©gorie pour l'explorer.");
            
            showStructuredMessage("üìö √âtape 1 : D√©couverte des cat√©gories", [
                {
                    type: 'info',
                    icon: 'üìñ',
                    title: 'Explication',
                    content: '- La bibliotheque est organis√©e en plusieurs cat√©gories affich√©es par ordre alphabetique dans le volet de gauche.<br>- Chaque cat√©gorie est th√©matis√©e et contient des images sp√©cifiques.<br>- Les images de chaque cat√©gorie sont sp√©cifiquement cr√©es pour s\'afficher correctement comme fond de Bulle ou comme fond d\'√©cran.'
                }
            ], 'validateStep1()');
            
            // D√©marrer la boucle d'animation
            startCategoryAnimationLoop();
        }

        function startCategoryAnimationLoop() {
            categoryAnimationActive = true;

            // Mettre en surbrillance simplement et statiquement les 10 premi√®res cat√©gories
            const categoryButtons = document.querySelectorAll('.category-button');
            const firstTwelveCategories = Array.from(categoryButtons).slice(0, 12);
            firstTwelveCategories.forEach(btn => btn.classList.add('demo-highlight-orange'));
        }

        function showCategoryExploration() {
            updateInstruction("√âtape 2 : üéØ ACTION REQUISE - Cliquez, dans l'ordre, sur les 3 premi√®res cat√©gories.");
            
            // R√©initialiser les s√©lections de l'utilisateur
            userSelectedCategories = [];
            
            // Afficher le message explicatif
            showStructuredMessage("üîÑ √âtape 2 : Navigation entre cat√©gories", [
                {
                    type: 'info',
                    icon: 'üìñ',
                    title: 'Explication',
                    content: 'Cliquez sur les onglets de cat√©gories pour afficher les images correspondantes. Chaque cat√©gorie regroupe des images par th√®me.'
                },
                {
                    type: 'action',
                    icon: 'üéØ',
                    title: 'ACTION REQUISE',
                    content: 'Cliquez sur la cat√©gorie qui clignote dans le volet de gauche.\nVeuillez cliquer sur 3 cat√©gorie pour valider l\'√©tape.'
                },
                {
                    type: 'tip',
                    icon: 'üí°',
                    title: 'üí° Progression',
                    content: 'Cat√©gories s√©lectionn√©es : 0/3'
                }
            ]);
            
            // D√©marrer le guidage s√©quentiel (3 premi√®res cat√©gories)
            startSequentialCategoryGuidance();
        }

        function startSequentialCategoryGuidance() {
            const guidedCategories = ['abstract', 'bricks', 'floral'];
            let guidedIndex = 0;
            const categoryButtons = document.querySelectorAll('.category-button');

            const highlightCurrent = () => {
                // Retirer tout highlight existant
                categoryButtons.forEach(btn => {
                    btn.classList.remove('demo-highlight');
                    btn.classList.remove('demo-highlight-orange');
                });
                // Mettre en √©vidence uniquement la cat√©gorie courante
                const currentId = guidedCategories[guidedIndex];
                const currentBtn = document.querySelector(`.category-button[data-category="${currentId}"]`);
                if (currentBtn) currentBtn.classList.add('demo-highlight-orange');
            };

            const onCategoryClick = (e) => {
                const clickedId = e.currentTarget.dataset.category;
                const expectedId = guidedCategories[guidedIndex];
                if (clickedId !== expectedId) {
                    return; // Ignorer les clics hors s√©quence
                }

                // Enregistrer et appliquer la s√©lection
                userSelectedCategories.push(clickedId);
                selectCategory(clickedId);
                updateCategoryProgressMessage();

                // Avancer ou valider
                guidedIndex++;
                if (guidedIndex >= guidedCategories.length) {
                    // Retirer tout highlight et terminer l'√©tape
                    categoryButtons.forEach(btn => {
                        btn.classList.remove('demo-highlight');
                        btn.classList.remove('demo-highlight-orange');
                    });
                    validateStep2();
                    // Nettoyer les √©couteurs
                    categoryButtons.forEach(btn => btn.removeEventListener('click', onCategoryClick));
                } else {
                    highlightCurrent();
                }
            };

            // Attacher les √©couteurs
            categoryButtons.forEach(btn => btn.addEventListener('click', onCategoryClick));
            // Initialiser le premier highlight
            highlightCurrent();
        }

        function updateCategoryProgressMessage() {
            // Mettre √† jour le message avec la progression actuelle
            const messageContainer = document.querySelector('.demo-message');
            if (messageContainer) {
                const progressSection = messageContainer.querySelector('.tip-section .section-content');
                if (progressSection) {
                    progressSection.textContent = `Cat√©gories s√©lectionn√©es : ${userSelectedCategories.length}/3`;
                }
            }
        }


        function showImageSelection() {
            updateInstruction("√âtape 3 : üéØ ACTION REQUISE - Cliquez sur n'importe quelle image pour la s√©lectionner et voir les options disponibles.");
            currentStep = 2;
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = false;
            
            // Mettre en surbrillance toutes les images et attendre le clic utilisateur
            setTimeout(() => {
                const allImages = document.querySelectorAll('.image-button');
                const imagesGrid = document.querySelector('.images-grid');
                if (allImages.length > 0 && imagesGrid) {
                    showStructuredMessage("‚ú® √âtape 3 : S√©lection d'image", [
                        {
                            type: 'info',
                            icon: 'üìñ',
                            title: 'Explication',
                            content: 'Maintenant, nous allons voir comment s√©lectionner une image et utiliser les options disponibles.'
                        },
                        {
                            type: 'action',
                            icon: 'üéØ',
                            title: 'ACTION REQUISE',
                            content: 'Cliquez sur n\'importe quelle image pour la s√©lectionner. Les boutons \'S√©lectionner\' et \'Appliquer comme fond\' deviendront alors actifs.'
                        },
                        {
                            type: 'tip',
                            icon: 'üí°',
                            title: 'Conseil',
                            content: 'Toutes les images clignotent pour vous montrer qu\'elles sont s√©lectionnables !'
                        }
                    ]);
                    
                    // Mettre en surbrillance toutes les images
                    allImages.forEach(img => {
                        img.classList.add('demo-highlight');
                    });
                    
                    // √âcoute d√©l√©gu√©e pour permettre la s√©lection m√™me si la cat√©gorie change
                    const delegatedClickHandler = (event) => {
                        const targetButton = event.target.closest('.image-button');
                        if (!targetButton) return;

                        document.querySelectorAll('.image-button').forEach(img => {
                            img.classList.remove('demo-highlight');
                        });

                        updateProgress(75); // √âtape 3 atteinte
                        closeAllMessages();
                        showButtonExplanations();

                        imagesGrid.removeEventListener('click', delegatedClickHandler);
                    };

                    imagesGrid.addEventListener('click', delegatedClickHandler);
                }
            }, 1000);
        }

        function showButtonExplanations() {
            updateInstruction("√âtape 4 : üéØ ACTION REQUISE - Cliquez sur le bouton 'Appliquer comme fond d'√©cran' mis en surbrillance pour l'essayer !");
            currentStep = 3;
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = false;
            
            // Mettre en surbrillance le bouton AVANT d'afficher le message
            highlightButton('applyWallpaperBtn', 'applyWallpaperHighlight');
            
            // Attendre un peu puis afficher le message
            setTimeout(() => {
                showStructuredMessage("üîò √âtape 4 : Bouton 'Appliquer comme fond d'√©cran'", [
                    {
                        type: 'info',
                        icon: 'üìñ',
                        title: 'Fonction du bouton',
                        content: 'Applique l\'image s√©lectionn√©e comme fond d\'√©cran imm√©diatement.'
                    },
                    {
                        type: 'tip',
                        icon: 'üí°',
                        title: 'Conseil',
                        content: 'Permet d\'appliquer rapidement diff√©rentes images comme fond d\'√©cran et de voir imm√©diatement le r√©sultat.'
                    },
                    {
                        type: 'action',
                        icon: 'üéØ',
                        title: 'ACTION REQUISE',
                        content: 'Cliquez sur le bouton \'Appliquer comme fond d\'√©cran\' mis en surbrillance pour l\'essayer !'
                    },
                    {
                        type: 'tip',
                        icon: 'üëÄ',
                        title: 'Indication visuelle',
                        content: 'Le bouton clignote pour attirer votre attention !'
                    }
                ]);
                
                // Ajouter un event listener pour d√©tecter le clic utilisateur
                const applyWallpaperBtn = document.getElementById('applyWallpaperBtn');
                if (applyWallpaperBtn) {
                    const handleWallpaperClick = () => {
                        // Appliquer la couleur de l'image s√©lectionn√©e au fond du canvas de d√©monstration
                        const demoCanvas = document.querySelector('.demo-bubble-canvas');
                        if (demoCanvas) {
                            demoCanvas.style.backgroundColor = selectedImageColor || '#0078d4';
                        }
                        
                        // Supprimer la surbrillance
                        hideHighlight('applyWallpaperHighlight');
                        
                        // √âtape 4 atteinte
                        updateProgress(85);
                        
                        // Fermer le message et passer √† l'√©tape suivante (s√©lection image pour bulle)
                        closeAllMessages();
                        showBubbleImagePick();
                        
                        // Supprimer l'event listener apr√®s utilisation
                        applyWallpaperBtn.removeEventListener('click', handleWallpaperClick);
                    };
                    
                    applyWallpaperBtn.addEventListener('click', handleWallpaperClick);
                }
            }, 500);
        }

        function showBubbleImagePick() {
            updateInstruction("√âtape 5 : üéØ ACTION REQUISE - S√©lectionnez une nouvelle image pour le fond de bulle.");
            currentStep = 4;
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = false;

            setTimeout(() => {
                const allImages = document.querySelectorAll('.image-button');
                const imagesGrid = document.querySelector('.images-grid');
                if (allImages.length > 0 && imagesGrid) {
                    showStructuredMessage("üñºÔ∏è √âtape 5 : S√©lection d'une image (fond de bulle)", [
                        {
                            type: 'info',
                            icon: 'üìñ',
                            title: 'Explication',
                            content: 'Choisissez une image (de pr√©f√©rence diff√©rente de celle de l\'√©tape 3) qui servira de fond pour la bulle.'
                        },
                        {
                            type: 'action',
                            icon: 'üéØ',
                            title: 'ACTION REQUISE',
                            content: 'Cliquez sur une image pour la s√©lectionner. Nous l\'appliquerons √† la bulle √† l\'√©tape suivante.'
                        }
                    ]);

                    allImages.forEach(img => img.classList.add('demo-highlight'));

                    const delegatedClickHandler = (event) => {
                        const targetButton = event.target.closest('.image-button');
                        if (!targetButton) return;

                        document.querySelectorAll('.image-button').forEach(img => img.classList.remove('demo-highlight'));
                        updateProgress(95);
                        closeAllMessages();
                        showBubbleSelectButtonExplanation();

                        imagesGrid.removeEventListener('click', delegatedClickHandler);
                    };

                    imagesGrid.addEventListener('click', delegatedClickHandler);
                }
            }, 600);
        }

        function showBubbleSelectButtonExplanation() {
            updateInstruction("√âtape 6 : üéØ ACTION REQUISE - Cliquez sur le bouton 'S√©lectionner' pour appliquer l'image √† la bulle.");
            currentStep = 5;
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = false;

            showStructuredMessage("üéØ √âtape 6 : Bouton 'S√©lectionner' (fond de bulle)", [
                {
                    type: 'info',
                    icon: 'üìñ',
                    title: 'Fonction du bouton',
                    content: 'Applique l\'image s√©lectionn√©e comme fond de bulle.'
                },
                {
                    type: 'tip',
                    icon: 'üí°',
                    title: 'Diff√©rence avec le fond d\'√©cran',
                    content: 'Le bouton "S√©lectionner" applique l\'image uniquement √† la bulle, pas au fond d\'√©cran.'
                },
                {
                    type: 'action',
                    icon: 'üéØ',
                    title: 'ACTION REQUISE',
                    content: 'Cliquez sur le bouton "S√©lectionner" pour appliquer l\'image √† la bulle.'
                }
            ]);

            highlightButton('selectBtn', 'selectBtnHighlight');

            const selectBtn = document.getElementById('selectBtn');
            if (selectBtn) {
                const handleSelectClick = () => {
                    const categoryData = categories[currentCategory];
                    const selectedColor = categoryData.colors[selectedImageIndex];
                    updateDemoBubble(categoryData.name, selectedColor);
                    hideHighlight('selectBtnHighlight');
                    updateProgress(95);
                    closeAllMessages();
                    showFinalMessage();
                    selectBtn.removeEventListener('click', handleSelectClick);
                };
                selectBtn.addEventListener('click', handleSelectClick);
            }
        }

        function showSelectButtonExplanation() {
            updateInstruction("√âtape 5 : üéØ ACTION REQUISE - S√©lectionnez une nouvelle image puis cliquez sur 'S√©lectionner' pour l'appliquer √† la bulle.");
            currentStep = 4;
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = false;
            
            // Mettre en surbrillance toutes les images et attendre le clic utilisateur
            setTimeout(() => {
                const allImages = document.querySelectorAll('.image-button');
                if (allImages.length > 0) {
                    showStructuredMessage("üéØ √âtape 5 : Bouton 'S√©lectionner'", [
                        {
                            type: 'info',
                            icon: 'üìñ',
                            title: 'Fonction du bouton',
                            content: 'Applique l\'image s√©lectionn√©e comme fond de bulle.'
                        },
                        {
                            type: 'tip',
                            icon: 'üí°',
                            title: 'Diff√©rence avec le bouton pr√©c√©dent',
                            content: 'Contrairement au bouton "Appliquer comme fond d\'√©cran", celui-ci applique l\'image uniquement comme fond de la bulle s√©lectionn√©e.'
                        },
                        {
                            type: 'action',
                            icon: 'üéØ',
                            title: 'ACTION REQUISE',
                            content: 'S√©lectionnez une nouvelle image (diff√©rente de celle de l\'√©tape 3) puis cliquez sur le bouton "S√©lectionner" pour l\'appliquer √† la bulle.'
                        }
                    ]);
                    
                    // Mettre en surbrillance toutes les images
                    allImages.forEach(img => {
                        img.classList.add('demo-highlight');
                    });
                    
                    // Ajouter un event listener pour d√©tecter le clic utilisateur sur n'importe quelle image
                    const handleImageClick = (event) => {
                        // Retirer la surbrillance de toutes les images
                        allImages.forEach(img => {
                            img.classList.remove('demo-highlight');
                        });
                        
                        // Mettre en surbrillance le bouton "S√©lectionner"
                        highlightButton('selectBtn', 'selectBtnHighlight');
                        
                        // Ajouter un event listener pour le bouton "S√©lectionner"
                        const selectBtn = document.getElementById('selectBtn');
                        if (selectBtn) {
                            const handleSelectClick = () => {
                                // Appliquer la couleur de l'image s√©lectionn√©e √† la bulle
                                const categoryData = categories[currentCategory];
                                const selectedColor = categoryData.colors[selectedImageIndex];
                                updateDemoBubble(categoryData.name, selectedColor);
                                
                                // Supprimer la surbrillance
                                hideHighlight('selectBtnHighlight');
                                
                                // Atteindre 95% √† la fin de l'√©tape 5
                                updateProgress(95);
                                
                                // Fermer le message et passer √† l'√©tape suivante
                                closeAllMessages();
                                showFinalMessage();
                                
                                // Supprimer l'event listener apr√®s utilisation
                                selectBtn.removeEventListener('click', handleSelectClick);
                            };
                            
                            selectBtn.addEventListener('click', handleSelectClick);
                        }
                        
                        // Supprimer l'event listener apr√®s utilisation
                        allImages.forEach(img => {
                            img.removeEventListener('click', handleImageClick);
                        });
                    };
                    
                    allImages.forEach(img => {
                        img.addEventListener('click', handleImageClick);
                    });
                }
            }, 1000);
        }

        function showFinalMessage() {
            updateInstruction("√âtape 6 : D√©monstration termin√©e !");
            // Forcer la progression √† 100% √† l'√©tape finale
            updateProgress(100);
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = true;
            showStructuredMessage("üéâ √âtape 6 : D√©monstration termin√©e !", [
                {
                    type: 'info',
                    icon: '‚úÖ',
                    title: 'F√©licitations !',
                    content: 'Vous avez maintenant une compr√©hension compl√®te des cat√©gories disponibles dans la biblioth√®que d\'images et de la diff√©rence entre les deux boutons d\'action.'
                },
                {
                    type: 'tip',
                    icon: 'üí°',
                    title: 'R√©capitulatif',
                    content: 'Vous savez maintenant : naviguer entre les cat√©gories, s√©lectionner une image, appliquer un fond d\'√©cran, et appliquer un fond de bulle.'
                },
                {
                    type: 'info',
                    icon: 'üéØ',
                    title: 'D√©monstration termin√©e !',
                    content: 'Vous avez maintenant explor√© les cat√©gories disponibles dans la biblioth√®que d\'images. Vous pouvez naviguer entre les diff√©rentes cat√©gories et s√©lectionner des images pour vos bulles.'
                }
            ], 'completeDemo()');
            
            // R√©initialiser le fond d'√©cran √† la fin de la d√©monstration
            document.body.style.backgroundColor = '';
        }


        function updateInstruction(text) {
            document.getElementById('demoInstruction').textContent = text;
        }

        function updateProgress(percentage) {
            const bar = document.getElementById('progressBar');
            bar.style.width = percentage + '%';
            if (percentage >= 100) {
                bar.style.background = 'linear-gradient(90deg, #28a745, #20c997)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #0078d4, #106ebe)';
            }
        }

        function showMessage(title, content) {
            // Fermer les messages existants
            closeAllMessages();
            
            const message = document.createElement('div');
            message.className = 'demo-message';
            message.innerHTML = `
                <button class="close-btn" onclick="closeMessage(this)">√ó</button>
                <h4>${title}</h4>
                <p>${content}</p>
            `;
            
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.appendChild(message);
            
            // Afficher avec animation
            setTimeout(() => {
                message.classList.add('show');
            }, 100);
            
            // Plus d'auto-fermeture: attend une action utilisateur
        }

        function showStructuredMessage(title, sections, validationCallback = null) {
            // Fermer les messages existants
            closeAllMessages();
            
            const message = document.createElement('div');
            message.className = 'demo-message';
            
            let sectionsHTML = '';
            sections.forEach(section => {
                const sectionClass = section.type === 'action' ? 'action-required' : 
                                   section.type === 'tip' ? 'tip-section' : '';
                sectionsHTML += `
                    <div class="message-section ${sectionClass}">
                        <div class="section-title">${section.icon} ${section.title}</div>
                        <div class="section-content">${section.content}</div>
                    </div>
                `;
            });
            
            let validationButtonHTML = '';
            if (validationCallback) {
                validationButtonHTML = `
                    <button class="validation-button" onclick="${validationCallback}">
                        ‚úì Valider cette √©tape
                    </button>
                `;
            }
            
            message.innerHTML = `
                <button class="close-btn" onclick="closeMessage(this)">√ó</button>
                <div class="message-title">${title}</div>
                ${sectionsHTML}
                ${validationButtonHTML}
            `;
            
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.appendChild(message);
            
            // Afficher avec animation
            setTimeout(() => {
                message.classList.add('show');
            }, 100);
            
            // Auto-fermer apr√®s 10 secondes si pas de bouton de validation ET pas d'action requise
            // D√©sactivation de l'auto-fermeture pour laisser l'utilisateur d√©cider quand continuer
            // Les messages avec boutons de validation ou actions requises ne se ferment pas automatiquement
        }

        function continueFromStartMessage() {
            closeAllMessages();
            highlightCategories();
        }

        function closeMessage(closeBtn) {
            const message = closeBtn.closest('.demo-message');
            if (message) {
                message.classList.remove('show');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 500);
            }
        }

        function closeAllMessages() {
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
        }

        // Fonctions de validation pour chaque √©tape
        function validateStep1() {
            categoryAnimationActive = false; // Arr√™ter l'animation des cat√©gories
            
            // Supprimer tous les effets d'animation des cat√©gories
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('demo-highlight');
            });
            
            updateProgress(33); // Atteindre 33% √† la validation de l'√©tape 1
            closeAllMessages();
            showCategoryExploration();
            currentStep = 1;
            document.getElementById('prevStepBtn').disabled = false;
        }

        function validateStep2() {
            updateProgress(66); // Atteindre 66% √† la validation de l'√©tape 2
            closeAllMessages();
            showImageSelection();
            currentStep = 2;
            document.getElementById('prevStepBtn').disabled = false;
        }

        function validateStep3() {
            closeAllMessages();
            showButtonExplanations();
            currentStep = 3;
            document.getElementById('prevStepBtn').disabled = false;
        }

        function validateStep4() {
            closeAllMessages();
            showBubbleImagePick();
            currentStep = 4;
            document.getElementById('prevStepBtn').disabled = false;
        }

        function validateStep5() {
            updateProgress(100); // Atteindre 100% √† la validation de l'√©tape 5
            closeAllMessages();
            showFinalMessage();
            currentStep = 5;
            document.getElementById('prevStepBtn').disabled = false;
        }

        function goToPreviousStep() {
            if (!demoRunning) return;
            if (currentStep <= 0) return;
            // Arr√™ter toutes les animations et effets visuels
            stopAllEffects();
            closeAllMessages();
            switch (currentStep) {
                case 1:
                    // Revenir √† l'√©tape 1
                    updateProgress(0);
                    document.getElementById('prevStepBtn').disabled = true;
                    highlightCategories();
                    currentStep = 0;
                    break;
                case 2:
                    // Revenir √† l'√©tape 2
                    updateProgress(33);
                    showCategoryExploration();
                    currentStep = 1;
                    document.getElementById('prevStepBtn').disabled = false;
                    break;
                case 3:
                    // Revenir √† l'√©tape 2
                    updateProgress(66);
                    showImageSelection();
                    currentStep = 2;
                    document.getElementById('prevStepBtn').disabled = false;
                    break;
                case 4:
                    // Revenir √† l'√©tape 3
                    updateProgress(75);
                    showButtonExplanations();
                    currentStep = 3;
                    document.getElementById('prevStepBtn').disabled = false;
                    break;
                case 5:
                    // Revenir √† l'√©tape 4
                    updateProgress(75);
                    showButtonExplanations();
                    currentStep = 3;
                    document.getElementById('prevStepBtn').disabled = false;
                    break;
                default:
                    break;
            }
        }

        function stopAllEffects() {
            // Flags d'animation
            categoryAnimationActive = false;
            navigationAnimationActive = false;

            // Nettoyer surbrillances des cat√©gories
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('demo-highlight');
                btn.classList.remove('demo-highlight-orange');
            });

            // Nettoyer surbrillances des images
            document.querySelectorAll('.image-button').forEach(btn => {
                btn.classList.remove('demo-highlight');
                btn.classList.remove('selected');
            });

            // Supprimer les overlays de mise en √©vidence de boutons
            document.querySelectorAll('.button-highlight').forEach(el => el.remove());

            // Retirer les √©couteurs sp√©cifiques ajout√©s pendant les √©tapes en rempla√ßant les n≈ìuds (cat√©gories et images)
            const categoriesList = document.querySelectorAll('.category-button');
            categoriesList.forEach(btn => {
                const clone = btn.cloneNode(true);
                btn.parentNode.replaceChild(clone, btn);
            });

            const imagesList = document.querySelectorAll('.image-button');
            imagesList.forEach(btn => {
                const clone = btn.cloneNode(true);
                btn.parentNode.replaceChild(clone, btn);
            });

            // R√©attacher les √©couteurs de base
            initializeCategories();
        }

        function completeDemo() {
            // Fermer la d√©monstration
            demoRunning = false;

            // Nettoyer effets et messages
            stopAllEffects();
            closeAllMessages();

            // R√©initialiser instruction et progression
            updateInstruction("Cette d√©monstration va vous montrer comment explorer les diff√©rentes cat√©gories disponibles dans la biblioth√®que d'images.");
            updateProgress(0);

            // R√©initialiser s√©lection cat√©gories et images
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('selected', 'demo-highlight');
            });
            const firstCategoryBtn = document.querySelector('[data-category="3d"]');
            if (firstCategoryBtn) firstCategoryBtn.classList.add('selected');
            currentCategory = '3d';
            selectedImageIndex = -1;
            selectedImageColor = null;
            userSelectedCategories = [];
            loadImagesForCategory('3d');

            // R√©initialiser la bulle et le fond d'√©cran de la d√©mo
            resetDemoBubble();
            const demoCanvas = document.querySelector('.demo-bubble-canvas');
            if (demoCanvas) demoCanvas.style.backgroundColor = '#2D2D2D';

            // R√©initialiser boutons
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.disabled = true;
            document.getElementById('startDemo').disabled = false;
            document.getElementById('stopDemo').disabled = true;
        }

        function highlightButton(buttonId, highlightId) {
            const button = document.getElementById(buttonId);
            if (button) {
                const rect = button.getBoundingClientRect();
                
                const highlight = document.createElement('div');
                highlight.className = 'button-highlight';
                highlight.id = highlightId;
                highlight.style.position = 'fixed';
                highlight.style.left = (rect.left - 3) + 'px';
                highlight.style.top = (rect.top - 3) + 'px';
                highlight.style.width = (rect.width + 6) + 'px';
                highlight.style.height = (rect.height + 6) + 'px';
                highlight.style.zIndex = '999';
                highlight.style.pointerEvents = 'none';
                
                document.body.appendChild(highlight);
                
                // Simuler un clic visuel
                button.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 150);
            }
        }

        function hideHighlight(highlightId) {
            const highlight = document.getElementById(highlightId);
            if (highlight) {
                highlight.remove();
            }
        }

        function initializeCategories() {
            const categoryButtons = document.querySelectorAll('.category-button');
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (!demoRunning) return; // Emp√™cher les clics pendant la d√©monstration
                    const category = this.dataset.category;
                    selectCategory(category);
                });
            });
        }

        function selectCategory(category) {
            // Mettre √† jour la s√©lection visuelle
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('selected');

            // Charger les images pour cette cat√©gorie
            currentCategory = category;
            loadImagesForCategory(category);
        }

        function loadImagesForCategory(category) {
            const categoryData = categories[category];
            const imagesGrid = document.getElementById('imagesGrid');
            const categoryTitle = document.getElementById('currentCategoryTitle');
            const statusText = document.getElementById('statusText');

            // Mettre √† jour le titre
            categoryTitle.textContent = categoryData.name;

            // G√©n√©rer les images avec des couleurs coh√©rentes par cat√©gorie
            imagesGrid.innerHTML = '';
            for (let i = 0; i < categoryData.count; i++) {
                const imageButton = document.createElement('button');
                imageButton.className = 'image-button';
                const coloredImage = generateColoredImage(categoryData.colors[i], i);
                imageButton.innerHTML = `<img src="${coloredImage}" alt="Image ${i + 1}">`;
                imageButton.addEventListener('click', function() {
                    if (!demoRunning) return; // Emp√™cher les clics pendant la d√©monstration
                    selectImage(i, this);
                });
                imagesGrid.appendChild(imageButton);
            }

            // Mettre √† jour le statut
            statusText.textContent = `${categoryData.name} - ${categoryData.count} image(s)`;

            // R√©initialiser la s√©lection
            selectedImageIndex = -1;
            document.getElementById('selectBtn').disabled = true;
            document.getElementById('applyWallpaperBtn').disabled = true;
        }

        function selectImage(index, buttonElement) {
            // Retirer la s√©lection pr√©c√©dente
            document.querySelectorAll('.image-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // S√©lectionner la nouvelle image
            buttonElement.classList.add('selected');
            selectedImageIndex = index;
            
            // Stocker la couleur de l'image s√©lectionn√©e
            const categoryData = categories[currentCategory];
            selectedImageColor = categoryData.colors[index];

            // Activer les boutons
            document.getElementById('selectBtn').disabled = false;
            document.getElementById('applyWallpaperBtn').disabled = false;

            // Mettre √† jour le statut
            const statusText = document.getElementById('statusText');
            statusText.textContent = `Image s√©lectionn√©e: Image ${index + 1}.jpg`;
        }

        function updateDemoBubble(categoryName, color) {
            const bubble = document.getElementById('demoBubble');
            const labelText = document.getElementById('bubbleLabelText');
            
            if (bubble && labelText) {
                // Mettre √† jour la couleur de fond de la bulle
                bubble.style.background = color;
                
                // Garder le texte de l'√©tiquette fixe
                labelText.textContent = 'Ma Bulle';
            }
        }

        function resetDemoBubble() {
            const bubble = document.getElementById('demoBubble');
            const labelText = document.getElementById('bubbleLabelText');
            const demoCanvas = document.querySelector('.demo-bubble-canvas');
            
            if (bubble && labelText) {
                // R√©initialiser la couleur de fond de la bulle
                bubble.style.background = '#2D2D30';
                
                // R√©initialiser le texte de l'√©tiquette
                labelText.textContent = 'Ma Bulle';
            }
            
            if (demoCanvas) {
                // R√©initialiser la couleur de fond du canvas
                demoCanvas.style.backgroundColor = '#2D2D2D';
            }
        }

        // Gestionnaires d'√©v√©nements pour les boutons
        document.getElementById('selectBtn').addEventListener('click', function() {
            if (selectedImageIndex >= 0) {
                // Le message d'alerte a √©t√© supprim√© pour la d√©monstration
            }
        });

        document.getElementById('applyWallpaperBtn').addEventListener('click', function() {
            if (selectedImageIndex >= 0) {
                // Le message d'alerte a √©t√© supprim√© pour la d√©monstration
            }
        });

        document.getElementById('cancelBtn').addEventListener('click', function() {
            closeWindow();
        });

        function closeWindow() {
            window.close();
        }
    </script>
</body>
</html>
