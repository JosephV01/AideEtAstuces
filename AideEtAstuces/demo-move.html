<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démonstration - Déplacer une Bulle sur le bureau - MyCustomDesk</title>
    <link rel="stylesheet" href="HelpAndTips.css">
    <link rel="stylesheet" href="demo-elements.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: var(--background-white);
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .demo-container {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            text-align: center;
        }

        .demo-canvas-container {
            background: #2D2D2D;
            border: 2px solid #555555;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        /* Utilisation de la classe dynamic-border pour la bulle à déplacer */
        .movable-bubble {
            /* Hérite de .dynamic-border, adaptations spécifiques */
            top: 100px; /* Position différente pour cette démo */
            transition: none; /* Pas de transition CSS pour un contrôle JavaScript précis */
        }

        /* Utilisation des classes label-border et label-text */
        .movable-label {
            /* Hérite de .label-border, adaptations spécifiques */
            top: -25px; /* Position relative à la bulle (au-dessus) */
            left: 100px; /* Centre de la bulle (200px/2) */
            transform: translateX(-50%);
            z-index: 1000;
        }

        /* Utilisation de la classe resize-handle */
        .movable-resize-handle {
            /* Hérite de .resize-handle, adaptations spécifiques */
            left: auto !important;
            top: auto !important;
            right: -5px;
            bottom: -5px;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        /* back-button styles removed to use global styles in demo-elements.css */
        
        /* S'assurer que le curseur reste au-dessus de tout */
        .mouse-cursor {
            z-index: 1500 !important;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1 class="demo-title">Démonstration - Déplacer une Bulle sur le bureau</h1>
            <p class="demo-description">
                Cette démonstration montre comment déplacer une Bulle sur votre bureau. Maintenez le clic gauche sur son étiquette tout en déplaçant la souris sur votre écran. Relâchez le clic une fois la Bulle correctement positionnée.
        
            </p>
        </div>
        
        <!-- Contrôle de vitesse standardisé (avec barre de progression intégrée) -->
        <div class="speed-control">
            <label for="speedSlider">Vitesse de l'animation :</label>
            <input type="range" id="speedSlider" min="0.25" max="3" step="0.25" value="1" class="speed-slider">
            <span id="speedValue">1x</span>
            <button id="pauseButton" class="pause-button">Pause</button>
            <button class="back-button" onclick="window.close()">Fermer</button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Préparation de la démonstration...</div>
        </div>
        
        <div class="demo-canvas-container">
            <div class="demo-canvas large">
                <!-- Bulle à déplacer (utilise dynamic-border) -->
                <div class="dynamic-border movable-bubble">
                    <div class="resize-handle movable-resize-handle"></div>
                    <!-- Étiquette de la bulle (enfant de la bulle) -->
                    <div class="label-border movable-label">
                        <span class="label-text">Déplacer la Bulle</span>
                    </div>
                </div>
                
                <!-- Curseur de souris -->
                <div class="mouse-cursor"></div>

                <!-- Souris avec boutons (état normal) -->
                <div class="mouse-zero-click large"></div>

                <!-- Souris avec bouton gauche coloré (pour les clics) -->
                <div class="mouse-left-click large"></div>

                <!-- Cercle d'animation de clic -->

            </div>
        </div>

        
    </div>

    <script>
        // Variables pour l'animation avec standardisation
        let animationPhase = 0;
        let animationTimer;
        let animationSpeed = 1;
        let isPaused = false;
        
        // Variables pour la progression
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        // Calculer le nombre total de frames de l'animation
        const totalAnimationFrames = 186; // Total jusqu'au redémarrage
        let baseInterval = 30; // Intervalle de base pour cette démo
        const CURSOR_SPEED_PX_PER_FRAME = 9; // Vitesse standardisée

        // Éléments DOM
        const mouseCursor = document.querySelector('.mouse-cursor');
        const mouseZeroClick = document.querySelector('.mouse-zero-click');
        const mouseLeftClick = document.querySelector('.mouse-left-click');
        const movableBubble = document.querySelector('.dynamic-border');
        const movableLabel = document.querySelector('.label-border');
        const movableResizeHandle = document.querySelector('.resize-handle');

        function startAnimation() {
            // Initialiser la progression
            updateProgress(0, totalAnimationFrames);
            
            const currentInterval = Math.round(baseInterval / animationSpeed);
            animationTimer = setInterval(() => {
                // Vérifier si l'animation est en pause
                if (isPaused) {
                    return;
                }
                
                animationPhase++;

                // 1 - Le curseur se dirige vers l'étiquette de la bulle
                if (animationPhase <= 30) {
                    const progress = animationPhase / 30;
                    const startX = 143, startY = 92;
                    const endX = 150, endY = 75; // Position de l'étiquette
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                // 2 - Apparition de l'effet de clic gauche
                else if (animationPhase <= 38) {
                    const clickPhase = animationPhase - 30;

                    // Changement de souris pour indiquer le clic gauche
                    if (clickPhase >= 3) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseLeftClick.style.visibility = 'visible';
                    }
                }
                // 3 - Déplacement fluide de la bulle
                else if (animationPhase <= 78) {
                    const moveProgress = (animationPhase - 38) / 40;
                    
                    // Position de la bulle (déplacement horizontal)
                    const bubbleStartX = 50, bubbleEndX = 200;
                    const bubbleX = bubbleStartX + (bubbleEndX - bubbleStartX) * moveProgress;
                    movableBubble.style.left = bubbleX + 'px';
                    movableBubble.style.top = '100px';
                    
                    // Le curseur reste sur l'étiquette (qui suit la bulle)
                    const cursorX = bubbleX + 100; // Centre de la bulle (200px/2)
                    const cursorY = 75; // Au-dessus de la bulle
                    mouseCursor.style.left = cursorX + 'px';
                    mouseCursor.style.top = cursorY + 'px';
                    
                }
                // 4 - Arrêt et disparition des effets
                else if (animationPhase <= 88) {
                    
                    // Reset de la souris
                    mouseZeroClick.style.visibility = 'visible';
                    mouseLeftClick.style.visibility = 'hidden';
                }
                // 5 - Pause à destination
                else if (animationPhase <= 108) {
                    // Rien ne change, juste un délai
                }
                // 6 - Deuxième clic pour initier le retour
                else if (animationPhase <= 116) {
                    const clickPhase = animationPhase - 108;

                    // Changement de souris pour indiquer le clic gauche
                    if (clickPhase >= 3) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseLeftClick.style.visibility = 'visible';
                    }
                }
                // 7 - Déplacement retour fluide
                else if (animationPhase <= 156) {
                    const moveProgress = (animationPhase - 116) / 40;
                    
                    // Position de la bulle (retour horizontal)
                    const bubbleStartX = 200, bubbleEndX = 50;
                    const bubbleX = bubbleStartX + (bubbleEndX - bubbleStartX) * moveProgress;
                    movableBubble.style.left = bubbleX + 'px';
                    movableBubble.style.top = '100px';
                    
                    // Le curseur reste sur l'étiquette (qui suit la bulle)
                    const cursorX = bubbleX + 100; // Centre de la bulle (200px/2)
                    const cursorY = 75; // Au-dessus de la bulle
                    mouseCursor.style.left = cursorX + 'px';
                    mouseCursor.style.top = cursorY + 'px';
                    
                }
                // 8 - Arrêt et disparition des effets au retour
                else if (animationPhase <= 166) {
                    
                    // Reset de la souris
                    mouseZeroClick.style.visibility = 'visible';
                    mouseLeftClick.style.visibility = 'hidden';
                }
                // 9 - Curseur disparaît
                else if (animationPhase <= 176) {
                    mouseCursor.style.opacity = '0';
                }
                // 10 - Delay
                else if (animationPhase <= 186) {
                    // Rien ne change, juste un délai
                }
                // Reset
                else {
                    animationPhase = 0;
                    movableBubble.style.left = '50px';
                    movableBubble.style.top = '100px';
                    mouseCursor.style.left = '143px';
                    mouseCursor.style.top = '92px';
                    mouseCursor.style.opacity = '1';

                    // Reset de la souris
                    mouseZeroClick.style.visibility = 'visible';
                    mouseLeftClick.style.visibility = 'hidden';
                }
                
                // Mettre à jour la progression
                updateProgress(animationPhase, totalAnimationFrames);
            }, currentInterval);
        }

        function restartAnimationWithNewSpeed() {
            if (animationTimer) {
                clearInterval(animationTimer);
            }
            startAnimation();
        }
        
        // Fonction pour mettre à jour la progression
        function updateProgress(phase, totalFrames) {
            // La progression doit atteindre 100% seulement au redémarrage de la boucle
            const percentage = phase >= totalFrames ? 100 : (phase / totalFrames) * 100;
            progressBar.style.width = percentage + '%';
            
            // Calculer les seuils basés sur les phases réelles de l'animation
            const phase1End = 30; // Fin du déplacement vers l'étiquette
            const phase2End = 38; // Fin du premier clic
            const phase3End = 78; // Fin du premier déplacement
            const phase4End = 88; // Fin du premier relâchement
            const phase5End = 108; // Fin de la pause
            const phase6End = 116; // Fin du deuxième clic
            const phase7End = 156; // Fin du deuxième déplacement
            const phase8End = 166; // Fin du deuxième relâchement
            const phase9End = 176; // Fin du retour à la position initiale
            const phase10End = 186; // Fin de l'animation
            
            // Mettre à jour le texte de progression
            if (phase <= phase1End) {
                progressText.textContent = 'Déplacement vers l\'étiquette...';
            } else if (phase <= phase2End) {
                progressText.textContent = 'Clic sur l\'étiquette...';
            } else if (phase <= phase3End) {
                progressText.textContent = 'Déplacement de la bulle...';
            } else if (phase <= phase4End) {
                progressText.textContent = 'Relâchement du clic...';
            } else if (phase <= phase5End) {
                progressText.textContent = 'Pause...';
            } else if (phase <= phase6End) {
                progressText.textContent = 'Deuxième clic...';
            } else if (phase <= phase7End) {
                progressText.textContent = 'Deuxième déplacement...';
            } else if (phase <= phase8End) {
                progressText.textContent = 'Deuxième relâchement...';
            } else if (phase <= phase9End) {
                progressText.textContent = 'Retour à la position initiale...';
            } else if (phase <= phase10End) {
                progressText.textContent = 'Animation terminée !';
            } else {
                progressText.textContent = 'Préparation du redémarrage...';
            }
        }

        function togglePause() {
            isPaused = !isPaused;
            const pauseButton = document.getElementById('pauseButton');
            
            if (isPaused) {
                pauseButton.textContent = 'Reprendre';
                pauseButton.classList.add('paused');
            } else {
                pauseButton.textContent = 'Pause';
                pauseButton.classList.remove('paused');
            }
        }

        // Démarrer l'animation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            const pauseButton = document.getElementById('pauseButton');
            
            if (speedSlider && speedValue) {
                speedSlider.addEventListener('input', function() {
                    animationSpeed = parseFloat(this.value);
                    speedValue.textContent = animationSpeed + 'x';
                    restartAnimationWithNewSpeed();
                });
                
                speedValue.textContent = animationSpeed + 'x';
            } else {
                console.warn('Éléments du slider non trouvés');
            }

            if (pauseButton) {
                pauseButton.addEventListener('click', togglePause);
            } else {
                console.warn('Bouton pause non trouvé');
            }

            setTimeout(startAnimation, 1000);
        });
    </script>
</body>
</html>
