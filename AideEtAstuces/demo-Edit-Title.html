<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démonstration - Personnaliser - MyCustomDesk</title>
    <link rel="stylesheet" href="HelpAndTips.css">
    <link rel="stylesheet" href="demo-elements.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: var(--background-white);
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .demo-container {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            text-align: center;
        }

        .demo-canvas-container {
            background: #2D2D2D;
            border: 2px solid #555555;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        .demo-title {
            color: var(--text-color);
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .demo-description {
            color: var(--text-light);
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Canvas adapté pour la fenêtre de personnalisation */
        .demo-canvas {
            position: relative;
            background: #2D2D2D;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            border-radius: 8px;
            overflow: visible;
        }

        /* === BORDURE DYNAMIQUE (BULLE) ADAPTÉE AU CANVAS AGRANDI === */
        .demo-canvas .dynamic-border {
            position: absolute;
            border: 3px solid white;
            background: #2D2D30;
            border-radius: 8px;
            width: 280px;
            height: 120px;
            left: 160px;
            top: 140px;
            transition: all 0.3s ease;
        }

        /* === ÉTIQUETTE ADAPTÉE AU CANVAS AGRANDI === */
        .demo-canvas .label-border {
            position: absolute;
            background: #2D2D30;
            border: 2px solid white;
            border-radius: 5px;
            padding: 5px 10px;
            height: 24px;
            left: 300px;
            top: 115px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto;
            min-width: fit-content;
            transform: translateX(-50%);
        }

        .demo-canvas .label-text {
            color: white;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
        }

        /* === CURSEUR DE SOURIS ADAPTÉ === */
        .demo-canvas .mouse-cursor {
            position: absolute;
            width: 16px;
            height: 16px;
            left: 300px;  /* Centre de la nouvelle bulle (160px + 280px/2 = 300px) */
            top: 200px;   /* Centre de la nouvelle bulle (140px + 120px/2 = 200px) */
            z-index: 1000;
            background: url('../Files/Cursor.png') no-repeat center;
            background-size: contain;
            visibility: hidden; /* Invisible par défaut */
        }

        /* === POIGNÉE DE REDIMENSIONNEMENT ADAPTÉE === */
        .demo-canvas .resize-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border: 2px solid black;
            border-radius: 50%;
            left: 431px;
            top: 251px;
            z-index: 999;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* === ANIMATION DE CLIC ADAPTÉE === */
        .demo-canvas .click-animation {
            position: absolute;
            width: 8px;
            height: 8px;
            background: cyan;
            border-radius: 50%;
            opacity: 0.7;
            z-index: 1002;
            visibility: hidden;
        }

        /* === MENU CONTEXTUEL ADAPTÉ === */
        .demo-canvas .context-menu {
            position: absolute;
            background: #2F2F2F;
            border: 2px solid #555555;
            border-radius: 6px;
            left: 340px;
            top: 80px;
            z-index: 999;
            visibility: hidden;
            padding: 8px 4px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
            min-width: 140px;
        }

        /* Menu contextuel adaptatif (override de demo-elements.css) */
        .context-menu {
            width: auto;
            min-width: 120px;
            height: auto;
        }

        .menu-item {
            padding: 5px 10px;
            margin: 2px 0;
            font-size: 10px;
            height: 20px;
            white-space: nowrap;
            min-width: fit-content;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
        }

        .menu-icon {
            flex-shrink: 0;
            color: #F0F0F0;
            width: 14px;
            height: 14px;
        }

        .menu-separator {
            margin: 1px 4px;
        }

        /* Styles pour le sous-menu */
        .menu-with-submenu {
            position: relative;
        }

        .submenu {
            position: absolute;
            left: 100%;
            top: -2px;  /* Légèrement vers le haut pour s'aligner avec l'option parent */
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 6px;
            min-width: 140px;
            visibility: hidden;
            opacity: 0;
            transform: translateX(-5px);
            transition: all 0.2s ease;
            z-index: 1000;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
            padding: 4px 2px;
        }

        .submenu-item {
            padding: 5px 10px;
            margin: 2px 0;
            font-size: 10px;
            height: 20px;
            white-space: nowrap;
            min-width: fit-content;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #F0F0F0;
            background: transparent;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
        }

        .submenu-item:hover {
            background: #404040;
        }



        /* Curseur de souris avec z-index élevé */
        .mouse-cursor {
            z-index: 1500 !important;
        }

        /* Position de la souris ajustée pour le canvas agrandi */
        .demo-canvas .mouse-zero-click {
            position: absolute;
            width: 25px;
            height: 38px;
            left: 555px;
            top: 25px;
            z-index: 1003;
            background: url('../Files/MouseZeroClick.png') no-repeat center;
            background-size: contain;
        }

        .demo-canvas .mouse-left-click {
            position: absolute;
            width: 25px;
            height: 38px;
            left: 555px;
            top: 25px;
            z-index: 1004;
            background: url('../Files/MouseLeftClick.png') no-repeat center;
            background-size: contain;
            visibility: hidden;
        }

        .demo-canvas .mouse-right-click {
            position: absolute;
            width: 25px;
            height: 38px;
            left: 555px;
            top: 25px;
            z-index: 1004;
            background: url('../Files/MouseRightClick.png') no-repeat center;
            background-size: contain;
            visibility: hidden;
        }


        .back-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        /* Styles pour la fenêtre TitleInput */
        .title-input-window {
            position: absolute;
            background: #ffffff;
            border: 2px solid #c0c0c0;
            border-radius: 15px;
            padding: 8px;
            width: 520px;
            max-width: 600px;
            min-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .title-input-content {
            margin: 20px;
            display: grid;
            grid-template-rows: auto auto auto auto 1fr auto;
            gap: 15px;
        }

        .window-title {
            text-align: center;
            font-weight: bold;
            color: #000000;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .input-label {
            color: #000000;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .title-textbox {
            height: 30px;
            background: #f0f0f0;
            border: 1px solid #c0c0c0;
            color: #000000;
            font-size: 14px;
            padding: 0 5px;
            display: block;
            width: 100%;
            font-family: 'Segoe UI Variable', 'Segoe UI', sans-serif;
        }

        .input-row { 
            display: flex;
            flex-direction: column; 
        }

        .title-combo {
            height: 30px;
            background: #f0f0f0;
            border: 1px solid #c0c0c0;
            color: #000000;
            font-size: 14px;
            padding: 0 5px;
            display: block;
            width: 100%;
            font-family: 'Segoe UI Variable', 'Segoe UI', sans-serif;
        }

        .title-preview-box {
            background: #f0f0f0;
            border: 1px solid #c0c0c0;
            border-radius: 10px;
            padding: 10px;
        }

        .title-preview-label { 
            color: #000000; 
            font-size: 12px; 
            margin-bottom: 10px; 
        }

        .title-preview-surface {
            background: #f0f0f0;
            border: 2px solid #c0c0c0;
            border-radius: 10px;
            padding: 8px 4px;
            min-width: 120px;
            max-width: 300px;
            margin: 0 auto;
        }

        .title-preview-text {
            color: #000000;
            font-weight: 700;
            font-size: 16px;
            text-align: center;
            word-wrap: break-word;
            white-space: nowrap;
        }

        .title-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .title-button {
            width: 100px;
            height: 30px;
            background: #f0f0f0;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            font-size: 12px;
            color: #000000;
            cursor: pointer;
            font-family: 'Segoe UI Variable', 'Segoe UI', sans-serif;
            transition: background-color 0.2s ease;
        }

        .title-button:hover { 
            background: #e0e0e0; 
        }

        /* Styles pour la démonstration interactive */
        .demo-progress-window {
            width: 100%;
            background: #ffffff;
            border: 2px solid #c0c0c0;
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: block;
            margin-bottom: 20px;
        }

        .demo-progress-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .demo-progress-header {
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .demo-progress-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d2d30;
            margin-bottom: 4px;
        }

        .demo-progress-subtitle {
            font-size: 12px;
            color: #666666;
        }

        .demo-progress-body {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .demo-progress-instruction {
            font-size: 13px;
            color: #2d2d30;
            line-height: 1.4;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #0078d4;
        }

        .demo-progress-bar-container {
            background: #e0e0e0;
            border-radius: 8px;
            height: 16px;
            overflow: hidden;
        }

        .demo-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0078d4, #106ebe);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .demo-progress-controls {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .demo-button {
            padding: 6px 12px;
            border: 2px solid #0078d4;
            background: #0078d4;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            background: #106ebe;
            border-color: #106ebe;
        }

        .demo-button.secondary {
            background: white;
            color: #0078d4;
        }

        .demo-button.secondary:hover {
            background: #f0f8ff;
        }

        .demo-button:disabled {
            background: #cccccc;
            border-color: #cccccc;
            cursor: not-allowed;
        }

        .demo-layout {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: stretch;
        }

        .demo-main-panel {
            flex: 1;
            min-width: 680px;            
            max-width: 100%;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .demo-main-container {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            text-align: center;
            flex-shrink: 0;
        }

        .demo-main-messages {
            flex: 1;
            min-width: 300px;
            padding-left: 0;
        }

        .demo-messages-panel {
            display: none;
        }

        #messagesContainer {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .demo-main-messages #messagesContainer {
            height: auto;
            overflow-y: visible;
        }

        /* Styles pour les messages explicatifs (identiques au fichier de référence) */
        .demo-message {
            position: relative;
            background: #ffffff;
            color: #000000;
            padding: 14px 16px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.12);
            margin: 10px 0;
            max-width: 100%;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            border: 1px solid #e5e5e5;
        }

        .demo-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .demo-message .message-title {
            margin: 0 0 10px 0;
            font-size: 20px;
            font-weight: bold;
            color: #000000;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e5e5;
        }

        .demo-message .message-section {
            margin: 8px 0;
            padding: 10px 12px;
            background: #f8f9fb;
            border-radius: 8px;
            border-left: 4px solid #cfd8dc;
        }

        .demo-message .section-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 6px 0;
            color: #000000;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .demo-message .section-content {
            font-size: 15px;
            line-height: 1.45;
            color: #000000;
            margin: 0;
        }

        .demo-message .action-required {
            background: #ffffff;
            border-left-color: #000000;
            position: relative;
        }

        .demo-message .action-required::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px solid #dc3545;
            border-radius: 10px;
            animation: actionRequiredPulse 2.5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes actionPulse {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(255, 107, 53, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
            }
        }

        @keyframes actionRequiredPulse {
            0% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
            }
            50% { 
                opacity: 1; 
                box-shadow: 0 0 0 8px rgba(220, 53, 69, 0);
            }
            100% { 
                opacity: 0.3; 
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
            }
        }

        .demo-message .tip-section {
            background: #fff8e1;
            border-left-color: #ffcc80;
        }

        .demo-message .validation-button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(40, 167, 69, 0.28);
        }

        .demo-message .validation-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .demo-message .validation-button:active {
            transform: translateY(0);
        }

        .demo-message .close-btn {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: #000000;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-message .close-btn:hover {
            background: rgba(0,0,0,0.06);
            border-radius: 50%;
        }

        .demo-message .validation-button {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(40, 167, 69, 0.28);
        }

        .demo-message .validation-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .demo-message .validation-button:active {
            transform: translateY(0);
        }

        .demo-message .close-btn {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: #000000;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-message .close-btn:hover {
            background: rgba(0,0,0,0.06);
            border-radius: 50%;
        }

        /* IMPORTANT: Surcharge forcée pour garantir l'affichage en noir - exclut demo-elements.css */
        .demo-container .demo-message,
        .demo-container .demo-message *,
        .demo-message,
        .demo-message * {
            color: #000000 !important;
        }

        .demo-container .demo-message .message-title,
        .demo-message .message-title {
            color: #000000 !important;
        }

        .demo-container .demo-message .section-title,
        .demo-message .section-title {
            color: #000000 !important;
        }

        .demo-container .demo-message .section-content,
        .demo-message .section-content {
            color: #000000 !important;
        }

        .demo-container .demo-message .close-btn,
        .demo-message .close-btn {
            color: #000000 !important;
        }

        /* Styles pour le bouton de validation désactivé */
        .demo-message .validation-button.disabled,
        .demo-message .validation-button:disabled {
            background: linear-gradient(135deg, #cccccc 0%, #999999 100%) !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1) !important;
            transform: none !important;
        }

        .demo-message .validation-button.disabled:hover,
        .demo-message .validation-button:disabled:hover {
            background: linear-gradient(135deg, #cccccc 0%, #999999 100%) !important;
            transform: none !important;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1) !important;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Fenêtre de progression de démonstration -->
        <div class="demo-progress-window" id="demoProgressWindow">
            <div class="demo-progress-content">
                <div class="demo-progress-header">
                    <div class="demo-progress-title">🎯 Démonstration : Édition du titre d'une bulle</div>
                    <div class="demo-progress-subtitle">Guide interactif pour accéder aux options de personnalisation et renommer l'étiquette d'une bulle</div>
                </div>
                
                <div class="demo-progress-body">
                    <div class="demo-progress-instruction" id="demoInstruction">
                        Cette démonstration vous apprend à accéder au menu contextuel d'une bulle et à utiliser l'option "Renommer l'étiquette" pour modifier le titre.
                    </div>
                    
                    <div class="demo-progress-bar-container">
                        <div class="demo-progress-bar" id="progressBar"></div>
                    </div>
                    
                    <div class="demo-progress-controls">
                        <button class="demo-button secondary" id="prevStepBtn" disabled>Étape précédente</button>
                        <button class="demo-button" id="startDemo">Démarrer</button>
                        <button class="demo-button secondary" id="stopDemo" disabled>Arrêter</button>
                        <button class="demo-button secondary" id="closeDemo">Fermer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disposition en colonnes -->
        <div class="demo-layout">
            <!-- Panneau principal : Canvas d'animation -->
            <div class="demo-main-panel">
                <div class="demo-main-container">
        <h1 class="demo-title">Démonstration - Personnaliser</h1>
        <p class="demo-description">
            Cette démonstration montre comment accéder aux options de personnalisation d'une bulle via le menu contextuel.
        </p>
        
        <div class="demo-canvas-container">
            <div class="demo-canvas">
                <!-- Bordure dynamique -->
                <div class="dynamic-border"></div>

                <!-- Étiquette centrée automatiquement -->
                <div class="label-border">
                    <div class="label-text">Personnaliser la Bulle</div>
                </div>

                <!-- Curseur de souris -->
                <div class="mouse-cursor"></div>

                <!-- Poignée de redimensionnement -->
                <div class="resize-handle"></div>

                <!-- Cercle d'animation de clic -->
                <div class="click-animation"></div>

                <!-- Souris avec boutons (état normal) -->
                <div class="mouse-zero-click"></div>

                <!-- Souris avec bouton droit coloré (pour les clics) -->
                <div class="mouse-right-click"></div>

                <!-- Souris avec bouton gauche coloré (pour les clics) -->
                <div class="mouse-left-click"></div>

                <!-- Menu contextuel simulé -->
                <div class="context-menu">
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z" fill="currentColor"/>
                        </svg>
                        Personnaliser la bulle
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item menu-with-submenu">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M420-160v-520H200v-120h560v120H540v520H420Z" fill="currentColor"/>
                        </svg>
                        Personnaliser le titre
                        <div class="submenu">
                            <div class="menu-item submenu-item">
                                <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M312-320h64l32-92h146l32 92h62L512-680h-64L312-320Zm114-144 52-150h4l52 150H426Zm54 384q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480h80q0 66 25 124.5t68.5 102q43.5 43.5 102 69T480-159q134 0 227-93t93-227q0-134-93-227t-227-93q-89 0-161.5 43.5T204-640h116v80H80v-240h80v80q55-73 138-116.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z" fill="currentColor"/>
                        </svg>
                                Renommer l'étiquette
                            </div>
                        </div>
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z" fill="currentColor"/>
                        </svg>
                        Éditer
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="M520-400h80v-120h120v-80H600v-120h-80v120H400v80h120v120ZM320-240q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H320Zm0-80h480v-480H320v480ZM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80H160Zm160-720v480-480Z" fill="currentColor"/>
                        </svg>
                        Dupliquer
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-item">
                        <svg class="menu-icon" viewBox="0 -960 960 960" width="12" height="12">
                            <path d="m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520Zm-400 0v520-520Z" fill="currentColor"/>
                        </svg>
                        Supprimer
                    </div>
                </div>

                <!-- Fenêtre TitleInput -->
                <div class="title-input-window">
                    <div class="title-input-content">
                        <div class="window-title">Saisir un titre</div>

                        <div class="input-row">
                            <div class="input-label">Texte</div>
                            <input id="titleInputField" class="title-textbox" type="text" />
                    </div>

                        <div class="input-row">
                            <div class="input-label">Titres prédéfinis</div>
                            <select id="presetComboField" class="title-combo">
                                <option>Sélectionner un titre prédéfini</option>
                                <option>Projets</option>
                                <option>Documents</option>
                                <option>Finances</option>
                                <option>Personnel</option>
                                <option>Travail</option>
                                <option>Photos</option>
                                <option>Voyage</option>
                                <option>Maison</option>
                                <option>Urgent</option>
                                <option>Idées</option>
                            </select>
                                </div>
                        
                        <div class="title-preview-box">
                            <div class="title-preview-label">Aperçu</div>
                            <div id="titlePreviewSurface" class="title-preview-surface">
                                <div id="titlePreviewText" class="title-preview-text">Titre</div>
                            </div>
                        </div>
                        
                        <div class="title-actions">
                            <button class="title-button" onclick="onTitleCancel()">Annuler</button>
                            <button class="title-button" onclick="onTitleOk()">OK</button>
                                </div>
                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                <!-- Zone des messages explicatifs à droite du container -->
                <div class="demo-main-messages">
                    <div id="messagesContainer"></div>
                </div>
            </div>

            <!-- Panneau messages (colonne droite) - maintenant vide -->
            <div class="demo-messages-panel">
                <!-- Messages maintenant dans demo-main-messages -->
                            </div>
                        </div>
    </div>

    <script>
        // Variables globales pour la démonstration
        let demoRunning = false;
        let currentStep = 0;
        let demoSteps = [
            "Clic droit sur la poignée pour ouvrir le menu contextuel",
            "Navigation vers l'option 'Personnaliser le titre'",
            "Clic sur la sous-option 'Renommer l'étiquette'",
            "Ouverture de la fenêtre de saisie du titre"
        ];

        // Variables pour l'animation
        let animationPhase = 0;
        let animationTimer;
        let animationCompletedOnce = false;
        let manualInputEntered = false;

        // Éléments DOM
        const mouseCursor = document.querySelector('.mouse-cursor');
        const mouseZeroClick = document.querySelector('.mouse-zero-click');
        const mouseRightClick = document.querySelector('.mouse-right-click');
        const mouseLeftClick = document.querySelector('.mouse-left-click');
        const clickAnimation = document.querySelector('.click-animation');
        const contextMenu = document.querySelector('.context-menu');
        const resizeHandle = document.querySelector('.resize-handle');
        const menuItems = document.querySelectorAll('.menu-item');
        const submenuItems = document.querySelectorAll('.menu-with-submenu');
        const submenu = document.querySelector('.submenu');
        const titleCustomizeItem = document.querySelector('.menu-with-submenu');
        const titleInputWindow = document.querySelector('.title-input-window');

        // Variables pour la fenêtre TitleInput
        let currentTitleText = '';

        function startAnimation() {
            // Rendre le curseur visible au début de l'animation
            mouseCursor.style.visibility = 'visible';
            
            animationTimer = setInterval(() => {
                animationPhase++;

                // Phase 1: Curseur se déplace vers la poignée
                if (animationPhase <= 35) {
                    const progress = animationPhase / 35;
                    const startX = 300, startY = 200;  // Position centrale de la bulle
                    const endX = 431, endY = 251;  // Position ajustée de la nouvelle poignée
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                // Phase 2: Animation de clic droit et expansion de la poignée
                else if (animationPhase <= 58) {
                    const clickPhase = animationPhase - 35;
                    
                    // Changement de souris pour le clic droit
                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseRightClick.style.visibility = 'visible';
                    }
                    
                    // Retour à la souris normale après le clic
                    if (clickPhase >= 4) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseRightClick.style.visibility = 'hidden';
                    }

                    // Animation d'expansion et rétraction de la poignée
                    if (clickPhase >= 3) {
                        const expandPhase = clickPhase - 3;
                        if (expandPhase <= 3) {
                            const scale = 1 + (expandPhase * 0.3);
                            resizeHandle.style.transform = `scale(${scale})`;
                            resizeHandle.style.background = '#ffffff';
                            resizeHandle.style.border = '2px solid #ffffff';
                        } else if (expandPhase <= 6) {
                            const shrinkPhase = expandPhase - 3;
                            const scale = 1.9 - (shrinkPhase * 0.3);
                            resizeHandle.style.transform = `scale(${scale})`;
                            resizeHandle.style.background = '#00ffff';
                            resizeHandle.style.border = '1px solid #000';
                        } else {
                            resizeHandle.style.transform = 'scale(1)';
                            resizeHandle.style.background = '#ffffff';
                            resizeHandle.style.border = '1px solid #000';
                        }
                    }
                }
                // Phase 3: Menu apparaît
                else if (animationPhase <= 62) {
                    const menuProgress = (animationPhase - 58) / 4;
                    contextMenu.style.visibility = 'visible';
                    contextMenu.style.opacity = menuProgress;
                    contextMenu.style.transform = `scale(${0.8 + menuProgress * 0.2})`;
                }
                // Phase 4: Menu visible
                else if (animationPhase <= 68) {
                    contextMenu.style.opacity = '1';
                    contextMenu.style.transform = 'scale(1)';
                }
                // Phase 5: Curseur se déplace vers "Personnaliser le titre"
                else if (animationPhase <= 85) {
                    const progress = (animationPhase - 68) / 17;
                    const startX = 431, startY = 251;  // Position ajustée de la nouvelle poignée
                    const endX = 380, endY = 120; // Position ajustée de l'option "Personnaliser le titre"
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                // Phase 6: Clic sur "Personnaliser le titre"
                else if (animationPhase <= 93) {
                    const clickPhase = animationPhase - 85;
                    
                    // Animation de clic
                    if (clickPhase <= 2) {
                        clickAnimation.style.visibility = 'visible';
                        clickAnimation.style.opacity = '0.5';
                        clickAnimation.style.width = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.height = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.left = (376 - clickPhase * 1.5) + 'px';  // Position ajustée
                        clickAnimation.style.top = (116 - clickPhase * 1.5) + 'px';  // Position ajustée
                    } else if (clickPhase <= 4) {
                        const shrinkPhase = clickPhase - 2;
                        clickAnimation.style.width = (14 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.height = (14 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.left = (373 + shrinkPhase * 1.5) + 'px';  // Position ajustée
                        clickAnimation.style.top = (113 + shrinkPhase * 1.5) + 'px';  // Position ajustée
                    } else {
                        clickAnimation.style.opacity = '0';
                    }

                    // Changement de souris au clic gauche (synchronisé)
                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseLeftClick.style.visibility = 'visible';
                    }
                    
                    // Retour immédiat à la souris normale après le clic
                    if (clickPhase >= 4) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseLeftClick.style.visibility = 'hidden';
                    }

                    // Effet de clic sur l'option "Personnaliser le titre" (similaire à la poignée)
                    if (clickPhase >= 1) {
                        if (titleCustomizeItem) {
                            if (clickPhase >= 1 && clickPhase <= 2.5) {
                                // Phase d'activation progressive
                                const activateProgress = (clickPhase - 1) / 1.5;
                                const scale = 1 - (activateProgress * 0.05); // Légère compression
                                titleCustomizeItem.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                                titleCustomizeItem.style.color = '#ffffff';
                                titleCustomizeItem.style.transform = `scale(${scale})`;
                                titleCustomizeItem.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                                const icon = titleCustomizeItem.querySelector('.menu-icon');
                                if (icon) icon.style.color = '#ffffff';
                            } else if (clickPhase <= 4) {
                                // Phase de relâchement progressive
                                const releaseProgress = (clickPhase - 2.5) / 1.5;
                                const scale = 0.95 + (releaseProgress * 0.05); // Retour à la normale
                                titleCustomizeItem.style.transform = `scale(${scale})`;
                                if (releaseProgress > 0.8) {
                                    titleCustomizeItem.style.background = '#404040';
                                    titleCustomizeItem.style.color = '#F0F0F0';
                                    titleCustomizeItem.style.boxShadow = 'none';
                                    const icon = titleCustomizeItem.querySelector('.menu-icon');
                                    if (icon) icon.style.color = '#F0F0F0';
                                }
                            } else {
                                titleCustomizeItem.style.background = '#404040';
                                titleCustomizeItem.style.color = '#F0F0F0';
                                titleCustomizeItem.style.transform = 'scale(1)';
                                titleCustomizeItem.style.boxShadow = 'none';
                                const icon = titleCustomizeItem.querySelector('.menu-icon');
                                if (icon) icon.style.color = '#F0F0F0';
                            }
                        }
                    }
                }
                // Phase 7: Sous-menu apparaît
                else if (animationPhase <= 100) {
                    const progress = (animationPhase - 93) / 7;
                    if (submenu) {
                        submenu.style.visibility = 'visible';
                        submenu.style.opacity = progress;
                        submenu.style.transform = `translateX(${-5 + progress * 5}px)`;
                    }
                }
                // Phase 8: Sous-menu visible
                else if (animationPhase <= 110) {
                    if (submenu) {
                        submenu.style.visibility = 'visible';
                        submenu.style.opacity = '1';
                        submenu.style.transform = 'translateX(0)';
                    }
                }
                // Phase 9: Curseur se déplace vers "Renommer l'étiquette"
                else if (animationPhase <= 125) {
                    const progress = (animationPhase - 110) / 15;
                    const startX = 380, startY = 120;  // Position ajustée
                    // Calcul précis du centre de la sous-option :
                    // Menu contextuel : left 340px + width 140px = 480px (bord droit)
                    // Submenu : width ~140px, donc centre = 480px + 70px = 550px
                    // Submenu-item : height 20px + padding 5px = 25px total, centre vertical = top + 12.5px
                    // Position Y : top menu (80px) + position "Personnaliser le titre" (~37px) + top submenu (-2px) + centre item (12.5px) = 127.5px
                    const endX = 550, endY = 128; // Centre géométrique ajusté pour le nouveau positionnement du sous-menu
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                // Phase 10: Clic sur "Renommer l'étiquette"
                else if (animationPhase <= 135) {
                    const clickPhase = animationPhase - 125;
                    
                    // Animation de clic
                    if (clickPhase <= 2) {
                        clickAnimation.style.visibility = 'visible';
                        clickAnimation.style.opacity = '0.5';
                        clickAnimation.style.width = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.height = (8 + clickPhase * 3) + 'px';
                        clickAnimation.style.left = (546 - clickPhase * 1.5) + 'px';  // Centre géométrique parfait
                        clickAnimation.style.top = (124 - clickPhase * 1.5) + 'px';  // Centre géométrique ajusté
                    } else if (clickPhase <= 4) {
                        const shrinkPhase = clickPhase - 2;
                        clickAnimation.style.width = (14 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.height = (14 - shrinkPhase * 3) + 'px';
                        clickAnimation.style.left = (543 + shrinkPhase * 1.5) + 'px';  // Centre géométrique parfait
                        clickAnimation.style.top = (121 + shrinkPhase * 1.5) + 'px';  // Centre géométrique ajusté
                    } else {
                        clickAnimation.style.opacity = '0';
                    }

                    // Changement de souris au clic gauche (synchronisé)
                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseLeftClick.style.visibility = 'visible';
                    }
                    
                    // Retour immédiat à la souris normale après le clic
                    if (clickPhase >= 4) {
                        mouseZeroClick.style.visibility = 'visible';
                        mouseLeftClick.style.visibility = 'hidden';
                    }

                    // Effet de clic sur "Renommer l'étiquette" (similaire à la poignée)
                    if (clickPhase >= 1) {
                        const submenuItem = document.querySelector('.submenu-item');
                        if (submenuItem) {
                            if (clickPhase >= 1 && clickPhase <= 2.5) {
                                // Phase d'activation progressive
                                const activateProgress = (clickPhase - 1) / 1.5;
                                const scale = 1 - (activateProgress * 0.05); // Légère compression
                                submenuItem.style.background = 'linear-gradient(135deg, #0078d4, #106ebe)';
                                submenuItem.style.color = '#ffffff';
                                submenuItem.style.transform = `scale(${scale})`;
                                submenuItem.style.boxShadow = `0 0 ${4 + activateProgress * 4}px rgba(0, 120, 212, ${0.3 + activateProgress * 0.3})`;
                                const icon = submenuItem.querySelector('.menu-icon');
                                if (icon) icon.style.color = '#ffffff';
                            } else if (clickPhase <= 4) {
                                // Phase de relâchement progressive
                                const releaseProgress = (clickPhase - 2.5) / 1.5;
                                const scale = 0.95 + (releaseProgress * 0.05); // Retour à la normale
                                submenuItem.style.transform = `scale(${scale})`;
                                if (releaseProgress > 0.8) {
                                    submenuItem.style.background = '#404040';
                                    submenuItem.style.color = '#F0F0F0';
                                    submenuItem.style.boxShadow = 'none';
                                    const icon = submenuItem.querySelector('.menu-icon');
                                    if (icon) icon.style.color = '#F0F0F0';
                                }
                            } else {
                                submenuItem.style.background = '#404040';
                                submenuItem.style.color = '#F0F0F0';
                                submenuItem.style.transform = 'scale(1)';
                                submenuItem.style.boxShadow = 'none';
                                const icon = submenuItem.querySelector('.menu-icon');
                                if (icon) icon.style.color = '#F0F0F0';
                            }
                        }
                    }
                }
                // Phase 11: Menu et sous-menu disparaissent
                else if (animationPhase <= 145) {
                    const progress = (animationPhase - 135) / 10;
                    contextMenu.style.opacity = 1 - progress;
                    contextMenu.style.transform = `scale(${1 - progress * 0.2})`;
                    if (submenu) {
                        submenu.style.opacity = 1 - progress;
                        submenu.style.transform = `translateX(${-progress * 5}px)`;
                    }
                }
                // Phase 12: Fenêtre TitleInput apparaît
                else if (animationPhase <= 155) {
                    const progress = (animationPhase - 145) / 10;
                    if (titleInputWindow) {
                        titleInputWindow.style.visibility = 'visible';
                        titleInputWindow.style.opacity = progress;
                        titleInputWindow.style.transform = `translate(-50%, -50%) scale(${0.8 + progress * 0.2})`;
                    }
                }
                // Phase 13: Fenêtre TitleInput visible
                else if (animationPhase <= 200) {
                    if (titleInputWindow) {
                        titleInputWindow.style.visibility = 'visible';
                        titleInputWindow.style.opacity = '1';
                        titleInputWindow.style.transform = 'translate(-50%, -50%) scale(1)';
                    }
                }
                // Phase 14: Fenêtre TitleInput se ferme
                else if (animationPhase <= 210) {
                    const progress = (animationPhase - 200) / 10;
                    if (titleInputWindow) {
                        titleInputWindow.style.opacity = 1 - progress;
                        titleInputWindow.style.transform = `translate(-50%, -50%) scale(${1 - progress * 0.2})`;
                    if (progress >= 0.8) {
                            titleInputWindow.style.visibility = 'hidden';
                    }
                }
                }
                // Reset pour boucle continue (si étape 1 non validée)
                else {
                    if (demoRunning && currentStep === 0) {
                        // Marquer l'animation comme complétée la première fois
                        if (!animationCompletedOnce) {
                            animationCompletedOnce = true;
                            enableValidationButton();
                        }
                        // Continuer la boucle pour l'étape 1
                        animationPhase = 0;
                        resetAnimationElements(true); // true = garder le curseur visible
                    } else {
                        // Arrêter l'animation si démonstration non active ou étape validée
                        clearInterval(animationTimer);
                        resetAnimationElements();
                        mouseCursor.style.visibility = 'hidden';  // S'assurer que le curseur est invisible
                    }
                }
            }, 50);
        }


        // Gestion du survol pour le sous-menu
        function setupSubmenuEvents() {
            submenuItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    const submenu = this.querySelector('.submenu');
                    if (submenu) {
                        submenu.style.visibility = 'visible';
                        submenu.style.opacity = '1';
                        submenu.style.transform = 'translateX(0)';
                    }
                });
                
                item.addEventListener('mouseleave', function() {
                    const submenu = this.querySelector('.submenu');
                    if (submenu) {
                        submenu.style.visibility = 'hidden';
                        submenu.style.opacity = '0';
                        submenu.style.transform = 'translateX(-5px)';
                    }
                });
            });
        }

        // Fonctions pour la fenêtre TitleInput
        function onTitleInputChange() {
            const input = document.getElementById('titleInputField');
            currentTitleText = input.value || '';
            updateTitlePreview();
        }

        function onTitleComboChange() {
            const combo = document.getElementById('presetComboField');
            if (combo.selectedIndex > 0) {
                const value = combo.value;
                document.getElementById('titleInputField').value = value;
                currentTitleText = value;
                updateTitlePreview();
            }
        }

        function handleTitleKeyDown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                onTitleOk();
            }
        }

        function updateTitlePreview() {
            const previewText = document.getElementById('titlePreviewText');
            const surface = document.getElementById('titlePreviewSurface');

            previewText.textContent = currentTitleText || 'Titre';

            const minSize = 12;
            const baseDefault = 16;
            const maxSize = 20;
            let size = baseDefault;

            const length = currentTitleText.length;
            if (!currentTitleText) {
                size = 16;
                surface.style.width = '120px';
                previewText.style.whiteSpace = 'nowrap';
            } else if (length > 35) {
                size = Math.max(minSize, 16 - (length - 35) * 0.3);
                previewText.style.whiteSpace = 'normal';
            } else if (length > 25) {
                size = Math.max(minSize, 16 - (length - 25) * 0.2);
                previewText.style.whiteSpace = 'normal';
            } else if (length < 10) {
                size = Math.min(maxSize, 16 + (10 - length) * 0.2);
                previewText.style.whiteSpace = 'nowrap';
            } else {
                previewText.style.whiteSpace = 'nowrap';
            }

            previewText.style.fontSize = size + 'px';

            const temp = document.createElement('span');
            temp.style.fontFamily = getComputedStyle(previewText).fontFamily;
            temp.style.fontSize = size + 'px';
            temp.style.fontWeight = getComputedStyle(previewText).fontWeight;
            temp.style.visibility = 'hidden';
            temp.style.whiteSpace = 'nowrap';
            temp.textContent = currentTitleText || 'Titre';
            document.body.appendChild(temp);
            const textWidth = temp.getBoundingClientRect().width;
            document.body.removeChild(temp);

            const padding = 16;
            const safety = 3;
            const total = textWidth + padding + safety;
            const finalWidth = Math.max(80, Math.min(300, total));
            surface.style.width = finalWidth + 'px';
        }

        function onTitleOk() {
            // Fermer la fenêtre TitleInput
            titleInputWindow.style.opacity = '0';
            titleInputWindow.style.transform = 'translate(-50%, -50%) scale(0.8)';
            titleInputWindow.style.visibility = 'hidden';
        }

        function onTitleCancel() {
            // Fermer la fenêtre TitleInput
            titleInputWindow.style.opacity = '0';
            titleInputWindow.style.transform = 'translate(-50%, -50%) scale(0.8)';
            titleInputWindow.style.visibility = 'hidden';
        }

        function setupTitleInputEvents() {
            const titleInput = document.getElementById('titleInputField');
            const presetCombo = document.getElementById('presetComboField');
            
            if (titleInput) {
                titleInput.addEventListener('input', onTitleInputChange);
                titleInput.addEventListener('keydown', handleTitleKeyDown);
            }
            if (presetCombo) {
                presetCombo.addEventListener('change', onTitleComboChange);
            }
            updateTitlePreview();
        }

        // Fonctions pour la démonstration interactive
        function setupEventListeners() {
            document.getElementById('startDemo').addEventListener('click', startDemo);
            document.getElementById('stopDemo').addEventListener('click', stopDemo);
            document.getElementById('closeDemo').addEventListener('click', closeDemo);
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) prevBtn.addEventListener('click', goToPreviousStep);
        }

        function startDemo() {
            if (demoRunning) return;
            
            demoRunning = true;
            currentStep = 0;
            
            // Mettre à jour les boutons
            document.getElementById('startDemo').disabled = true;
            document.getElementById('stopDemo').disabled = false;
            document.getElementById('prevStepBtn').disabled = true;
            
            // Commencer la démonstration avec un message
            setTimeout(() => {
                showStructuredMessage("🎯 Démonstration démarrée", [
                    {
                        type: 'info',
                        icon: '📖',
                        title: 'Bienvenue',
                        content: "Cette démonstration vous montre comment accéder aux options de personnalisation d'une bulle et renommer son étiquette."
                    },
                    {
                        type: 'action',
                        icon: '🎯',
                        title: 'Prêt à commencer',
                        content: 'Cliquez sur "Valider" pour démarrer l\'animation et voir le processus complet.'
                    }
                ], 'continueFromStartMessage()');
            }, 300);
        }

        function stopDemo() {
            demoRunning = false;
            completeDemo();
        }

        function resetDemo() {
            demoRunning = false;
            currentStep = 0;
            animationCompletedOnce = false;
            manualInputEntered = false;
            
            // Réinitialiser les boutons
            document.getElementById('startDemo').disabled = false;
            document.getElementById('stopDemo').disabled = true;
            document.getElementById('prevStepBtn').disabled = true;
            
            // Réinitialiser la progression
            updateProgress(0);
            updateInstruction("Cette démonstration vous apprend à accéder au menu contextuel d'une bulle et à utiliser l'option \"Renommer l'étiquette\" pour modifier le titre.");
            
            // Fermer tous les messages
            closeAllMessages();
        }

        function closeDemo() {
            window.close();
        }

        function continueFromStartMessage() {
            closeAllMessages();
            updateProgress(25);
            updateInstruction("Étape 1 : Observez l'animation complète qui montre le processus d'accès aux options de personnalisation.");
            
            // Réinitialiser le statut d'animation
            animationCompletedOnce = false;
            
            showStructuredMessage("🖱️ Étape 1 : Animation du processus complet", [
                {
                    type: 'info',
                    icon: '📖',
                    title: 'Observation',
                    content: 'Cette animation montre le processus complet : clic droit sur la poignée → menu contextuel → "Personnaliser le titre" → "Renommer l\'étiquette" → fenêtre de saisie.'
                },
                {
                    type: 'tip',
                    icon: '💡',
                    title: 'Animation en boucle',
                    content: 'L\'animation se répète en boucle pour que vous puissiez bien observer chaque étape. Le bouton de validation s\'activera automatiquement après un cycle complet.'
                }
            ], 'validateStep1()', true); // true = bouton initialement désactivé
            
            // Démarrer l'animation en boucle
            setTimeout(startAnimation, 1000);
        }

        function validateStep1() {
            // Arrêter l'animation en boucle
            clearInterval(animationTimer);
            resetAnimationElements();
            mouseCursor.style.visibility = 'hidden';
            
            updateProgress(50);
            currentStep = 1;
            document.getElementById('prevStepBtn').disabled = false;
            closeAllMessages();
            
            // Afficher la fenêtre TitleInput
            if (titleInputWindow) {
                titleInputWindow.style.visibility = 'visible';
                titleInputWindow.style.opacity = '1';
                titleInputWindow.style.transform = 'translate(-50%, -50%) scale(1)';
            }
            
            updateInstruction("Étape 2 : Utilisez le menu déroulant pour sélectionner un titre prédéfini.");
            
            showStructuredMessage("📝 Étape 2 : Fenêtre de saisie du titre", [
                {
                    type: 'info',
                    icon: '📖',
                    title: 'Explication de la fenêtre',
                    content: 'Cette fenêtre permet de modifier le titre de la bulle. Elle contient :<br>• Un champ de texte pour la saisie libre<br>• Un menu déroulant avec des titres prédéfinis<br>• Un aperçu en temps réel du résultat<br>• Les boutons OK et Annuler'
                },
                {
                    type: 'action',
                    icon: '🎯',
                    title: 'ACTION REQUISE',
                    content: 'Cliquez sur le menu déroulant "Titres prédéfinis" et sélectionnez n\'importe quel titre de la liste pour continuer.'
                },
                {
                    type: 'tip',
                    icon: '💡',
                    title: 'Conseil',
                    content: 'Le menu déroulant clignote pour attirer votre attention. L\'aperçu se met à jour automatiquement selon votre sélection.'
                }
            ]);
            
            // Mettre en évidence le menu déroulant
            highlightDropdown();
            // Écouter les changements sur le menu déroulant
            setupDropdownListener();
        }

        function validateStep2() {
            // Supprimer la mise en évidence du menu déroulant
            removeDropdownHighlight();
            
            updateProgress(75);
            currentStep = 2;
            closeAllMessages();
            
            // Vider le champ de saisie et réinitialiser la variable
            const titleInput = document.getElementById('titleInputField');
            if (titleInput) {
                titleInput.value = '';
                currentTitleText = '';
                updateTitlePreview();
            }
            manualInputEntered = false;
            
            updateInstruction("Étape 3 : Saisissez maintenant un titre personnalisé dans le champ de texte et cliquez sur OK.");
            
            showStructuredMessage("✏️ Étape 3 : Saisie manuelle du titre", [
                {
                    type: 'info',
                    icon: '📖',
                    title: 'Saisie libre',
                    content: 'Le champ de texte a été vidé. Vous devez maintenant taper directement un titre personnalisé. L\'aperçu se met à jour en temps réel.'
                },
                {
                    type: 'action',
                    icon: '🎯',
                    title: 'ACTION REQUISE',
                    content: 'Tapez un titre de votre choix dans le champ "Texte", puis cliquez sur le bouton "OK" pour valider et terminer la démonstration.'
                },
                {
                    type: 'tip',
                    icon: '💡',
                    title: 'Conseil',
                    content: 'Le bouton OK ne s\'activera qu\'après avoir tapé du texte manuellement dans le champ.'
                }
            ]);
            
            // Mettre en évidence le champ de texte
            highlightTextInput();
            // Écouter les changements dans le champ de texte
            setupManualInputListener();
        }

        function validateStep3() {
            // Supprimer les mises en évidence
            removeTextInputHighlight();
            
            // Récupérer le titre saisi par l'utilisateur
            const titleInput = document.getElementById('titleInputField');
            const userTitle = titleInput ? titleInput.value.trim() : '';
            
            // Mettre à jour le titre de la bulle
            const bubbleTitle = document.querySelector('.label-text');
            if (bubbleTitle && userTitle) {
                bubbleTitle.textContent = userTitle;
            }
            
            // Fermer la fenêtre TitleInput
            if (titleInputWindow) {
                titleInputWindow.style.opacity = '0';
                titleInputWindow.style.transform = 'translate(-50%, -50%) scale(0.8)';
                titleInputWindow.style.visibility = 'hidden';
            }
            
            updateProgress(100);
            currentStep = 3;
            closeAllMessages();
            
            updateInstruction("Démonstration terminée ! Vous maîtrisez maintenant le processus complet d'édition du titre d'une bulle.");
            
            showStructuredMessage("🎉 Démonstration terminée !", [
                {
                    type: 'info',
                    icon: '✅',
                    title: 'Félicitations !',
                    content: 'Vous avez appris à utiliser complètement la fonctionnalité d\'édition du titre d\'une bulle, depuis l\'accès au menu jusqu\'à la validation du nouveau titre.'
                },
                {
                    type: 'info',
                    icon: '🔄',
                    title: 'Résultat visible',
                    content: 'Regardez la bulle dans la démonstration : le titre a été mis à jour avec votre saisie personnalisée !'
                },
                {
                    type: 'tip',
                    icon: '💡',
                    title: 'Récapitulatif des étapes',
                    content: '1. Clic droit sur la poignée de la bulle<br>2. Sélection "Personnaliser le titre" → "Renommer l\'étiquette"<br>3. Utilisation du menu déroulant ou saisie libre<br>4. Validation avec le bouton OK'
                },
                {
                    type: 'info',
                    icon: '🎯',
                    title: 'Points clés appris',
                    content: 'Accès au menu contextuel, navigation dans les sous-menus, utilisation de la fenêtre de saisie avec aperçu temps réel, et validation des modifications.'
                }
            ], 'completeDemo()');
        }

        function goToPreviousStep() {
            if (!demoRunning || currentStep <= 0) return;
            
            closeAllMessages();
            currentStep--;
            
            switch (currentStep) {
                case 0:
                    updateProgress(25);
                    document.getElementById('prevStepBtn').disabled = true;
                    continueFromStartMessage();
                    break;
                case 1:
                    updateProgress(50);
                    validateStep1();
                    break;
                case 2:
                    updateProgress(75);
                    validateStep2();
                    break;
            }
        }

        function completeDemo() {
            demoRunning = false;
            
            // Réinitialiser le titre de la bulle
            const bubbleTitle = document.querySelector('.label-text');
            if (bubbleTitle) {
                bubbleTitle.textContent = 'Personnaliser la Bulle';
            }
            
            // Réinitialiser le champ de saisie dans la fenêtre TitleInput
            const titleInput = document.getElementById('titleInputField');
            if (titleInput) {
                titleInput.value = '';
            }
            currentTitleText = '';
            
            // Réinitialiser l'aperçu
            updateTitlePreview();
            
            // Fermer tous les messages et réinitialiser
            closeAllMessages();
            resetDemo();
        }

        function updateInstruction(text) {
            document.getElementById('demoInstruction').textContent = text;
        }

        function updateProgress(percentage) {
            const bar = document.getElementById('progressBar');
            bar.style.width = percentage + '%';
            if (percentage >= 100) {
                bar.style.background = 'linear-gradient(90deg, #28a745, #20c997)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #0078d4, #106ebe)';
            }
        }

        function showStructuredMessage(title, sections, validationCallback = null, disableButton = false) {
            closeAllMessages();
            
            const message = document.createElement('div');
            message.className = 'demo-message';
            
            let sectionsHTML = '';
            sections.forEach(section => {
                const sectionClass = section.type === 'action' ? 'action-required' : 
                                   section.type === 'tip' ? 'tip-section' : '';
                sectionsHTML += `
                    <div class="message-section ${sectionClass}">
                        <div class="section-title">${section.icon} ${section.title}</div>
                        <div class="section-content">${section.content}</div>
                    </div>
                `;
            });
            
            let validationButtonHTML = '';
            if (validationCallback) {
                const disabledAttr = disableButton ? 'disabled' : '';
                const disabledClass = disableButton ? 'disabled' : '';
                validationButtonHTML = `
                    <button class="validation-button ${disabledClass}" onclick="${validationCallback}" ${disabledAttr} id="validationButton">
                        ✓ Valider cette étape
                    </button>
                `;
            }
            
            message.innerHTML = `
                <button class="close-btn" onclick="closeMessage(this)">×</button>
                <div class="message-title">${title}</div>
                ${sectionsHTML}
                ${validationButtonHTML}
            `;
            
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.appendChild(message);
            
            setTimeout(() => {
                message.classList.add('show');
            }, 100);
        }

        function enableValidationButton() {
            const validationButton = document.getElementById('validationButton');
            if (validationButton) {
                validationButton.disabled = false;
                validationButton.classList.remove('disabled');
                
                // Effet visuel pour attirer l'attention
                validationButton.style.animation = 'actionPulse 3s ease-in-out 3';
                setTimeout(() => {
                    validationButton.style.animation = '';
                }, 9000);
            }
        }

        function closeMessage(closeBtn) {
            const message = closeBtn.closest('.demo-message');
            if (message) {
                message.classList.remove('show');
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 500);
            }
        }

        function closeAllMessages() {
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
        }

        // Fonctions utilitaires pour les étapes de démonstration
        function resetAnimationElements(keepCursorVisible = false) {
                    mouseCursor.style.left = '300px';  // Position centrale de la bulle
                    mouseCursor.style.top = '200px';   // Position centrale de la bulle
                    if (!keepCursorVisible) {
                        mouseCursor.style.visibility = 'hidden';  // Rendre invisible seulement si demandé
                    }
                    contextMenu.style.visibility = 'hidden';
                    contextMenu.style.opacity = '0';
                    contextMenu.style.transform = 'scale(0.8)';
                    clickAnimation.style.visibility = 'hidden';
                    clickAnimation.style.opacity = '0';
                    resizeHandle.style.transform = 'scale(1)';
                    resizeHandle.style.background = '#ffffff';
                    resizeHandle.style.border = '1px solid #000';
                    mouseZeroClick.style.visibility = 'visible';
                    mouseLeftClick.style.visibility = 'hidden';
            if (titleCustomizeItem) {
                titleCustomizeItem.style.background = 'transparent';
                titleCustomizeItem.style.color = '#F0F0F0';
                titleCustomizeItem.style.transform = 'scale(1)';
                titleCustomizeItem.style.boxShadow = 'none';
                const menuIcon2 = titleCustomizeItem.querySelector('.menu-icon');
                if (menuIcon2) menuIcon2.style.color = '#F0F0F0';
            }
            const submenuItem = document.querySelector('.submenu-item');
            if (submenuItem) {
                submenuItem.style.background = 'transparent';
                submenuItem.style.color = '#F0F0F0';
                submenuItem.style.transform = 'scale(1)';
                submenuItem.style.boxShadow = 'none';
                const submenuIcon = submenuItem.querySelector('.menu-icon');
                if (submenuIcon) submenuIcon.style.color = '#F0F0F0';
            }
            if (submenu) {
                submenu.style.visibility = 'hidden';
                submenu.style.opacity = '0';
                submenu.style.transform = 'translateX(-5px)';
            }
            if (titleInputWindow) {
                titleInputWindow.style.visibility = 'hidden';
                titleInputWindow.style.opacity = '0';
                titleInputWindow.style.transform = 'translate(-50%, -50%) scale(0.8)';
            }
        }

        function highlightDropdown() {
            const dropdown = document.getElementById('presetComboField');
            if (dropdown) {
                dropdown.style.animation = 'actionPulse 2.5s ease-in-out infinite';
                dropdown.style.border = '3px solid #ff6b35';
                dropdown.style.boxShadow = '0 0 10px #ff6b35';
            }
        }

        function removeDropdownHighlight() {
            const dropdown = document.getElementById('presetComboField');
            if (dropdown) {
                dropdown.style.animation = '';
                dropdown.style.border = '1px solid #c0c0c0';
                dropdown.style.boxShadow = '';
            }
        }

        function highlightTextInput() {
            const textInput = document.getElementById('titleInputField');
            const okButton = document.querySelector('.title-button[onclick="onTitleOk()"]');
            
            if (textInput) {
                textInput.style.animation = 'actionPulse 2.5s ease-in-out infinite';
                textInput.style.border = '3px solid #ff6b35';
                textInput.style.boxShadow = '0 0 10px #ff6b35';
            }
            
            if (okButton) {
                // Désactiver initialement le bouton OK
                okButton.disabled = true;
                okButton.style.opacity = '0.5';
                okButton.style.cursor = 'not-allowed';
                okButton.style.animation = '';
                okButton.style.border = '1px solid #c0c0c0';
                okButton.style.boxShadow = '';
            }
        }

        function removeTextInputHighlight() {
            const textInput = document.getElementById('titleInputField');
            const okButton = document.querySelector('.title-button[onclick="onTitleOk()"]');
            
            if (textInput) {
                textInput.style.animation = '';
                textInput.style.border = '1px solid #c0c0c0';
                textInput.style.boxShadow = '';
            }
            
            if (okButton) {
                okButton.style.animation = '';
                okButton.style.border = '1px solid #c0c0c0';
                okButton.style.boxShadow = '';
            }
        }

        function setupDropdownListener() {
            const dropdown = document.getElementById('presetComboField');
            if (dropdown) {
                const handleDropdownChange = (e) => {
                    if (e.target.selectedIndex > 0) {
                        // Une option a été sélectionnée
                        validateStep2();
                        dropdown.removeEventListener('change', handleDropdownChange);
                    }
                };
                dropdown.addEventListener('change', handleDropdownChange);
            }
        }

        function setupManualInputListener() {
            const textInput = document.getElementById('titleInputField');
            if (textInput) {
                const handleManualInput = (e) => {
                    if (e.target.value.trim().length > 0 && !manualInputEntered) {
                        manualInputEntered = true;
                        enableOkButton();
                        setupOkButtonListener();
                    }
                };
                textInput.addEventListener('input', handleManualInput);
            }
        }

        function enableOkButton() {
            const textInput = document.getElementById('titleInputField');
            const okButton = document.querySelector('.title-button[onclick="onTitleOk()"]');
            
            // Arrêter le clignotement du champ de saisie
            if (textInput) {
                textInput.style.animation = '';
                textInput.style.border = '1px solid #c0c0c0';
                textInput.style.boxShadow = '';
            }
            
            // Activer et faire clignoter uniquement le bouton OK
            if (okButton) {
                okButton.disabled = false;
                okButton.style.opacity = '1';
                okButton.style.cursor = 'pointer';
                okButton.style.animation = 'actionPulse 2.5s ease-in-out infinite';
                okButton.style.border = '3px solid #ff6b35';
                okButton.style.boxShadow = '0 0 10px #ff6b35';
            }
        }

        function setupOkButtonListener() {
            const okButton = document.querySelector('.title-button[onclick="onTitleOk()"]');
            if (okButton) {
                const handleOkClick = () => {
                    if (manualInputEntered) {
                        validateStep3();
                        okButton.removeEventListener('click', handleOkClick);
                    }
                };
                okButton.addEventListener('click', handleOkClick);
            }
        }

        // Démarrer l'animation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupSubmenuEvents();
            setupTitleInputEvents();
            // Ne pas démarrer l'animation automatiquement, attendre que l'utilisateur clique sur "Démarrer"
        });
    </script>
</body>
</html>
