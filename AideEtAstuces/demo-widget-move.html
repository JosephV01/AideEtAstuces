<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démonstration - Déplacer le Widget sur le bureau - MyCustomDesk</title>
    <link rel="stylesheet" href="HelpAndTips.css">
    <link rel="stylesheet" href="demo-elements.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: var(--background-white);
            font-family: 'Segoe UI Variable', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .demo-container {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            text-align: center;
        }

        .demo-canvas-container {
            background: #2D2D2D;
            border: 2px solid #555555;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        .movable-widget {
            position: absolute;
            border: 2px solid white;
            background: black;
            border-radius: 10px;
            width: 50px;
            height: 100px;
            left: 50px;
            top: 60px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }

        .widget-button {
            color: white;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            border: none;
        }

        .widget-button:hover {
            background: rgba(0,255,255,0.2);
            color: cyan;
        }

        .movable-widget {
            z-index: 1000;
        }

    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1 class="demo-title">Démonstration - Déplacer le Widget sur le bureau</h1>
            <p class="demo-description">
                Cette démonstration montre comment déplacer le Widget sur votre bureau. Maintenez le clic gauche sur son étiquette tout en déplaçant la souris sur votre écran. Relâchez le clic une fois le widget correctement positionné.
        
            </p>
        </div>

        <div class="speed-control">
            <label for="speedSlider">Vitesse de l'animation :</label>
            <input type="range" id="speedSlider" min="0.25" max="3" step="0.25" value="1" class="speed-slider">
            <span id="speedValue">1x</span>
            <button id="pauseButton" class="pause-button">Pause</button>
            <button class="back-button" onclick="window.close()">Fermer</button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Préparation de la démonstration...</div>
        </div>

        <div class="demo-canvas-container">
            <div class="demo-canvas">
                
                <div class="movable-widget">
                    <button class="widget-button">+</button>
                    <button class="widget-button">P</button>
                </div>

                <div class="mouse-cursor"></div>

                <div class="mouse-zero-click"></div>

                <div class="mouse-right-click"></div>

                <div class="destination-marker"></div>
            </div>
        </div>

    </div>

    <script>
        
        let animationPhase = 0;
        let animationTimer;

        let animationSpeed = 1;
        let isPaused = false;
        let baseInterval = 30; 

        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');

        const CURSOR_SPEED_PX_PER_FRAME = 9;

        const mouseCursor = document.querySelector('.mouse-cursor');
        const mouseZeroClick = document.querySelector('.mouse-zero-click');
        const mouseRightClick = document.querySelector('.mouse-right-click');
        const movableWidget = document.querySelector('.movable-widget');
        const widgetButtons = document.querySelectorAll('.widget-button');

        let movementFrames = 40; 
        let totalAnimationFrames = 0; 

        function startAnimation() {
            function runAnimationFrame() {
                
                if (isPaused) {
                    animationTimer = setTimeout(runAnimationFrame, 100); 
                    return;
                }
                
                animationPhase++;

                if (animationPhase <= movementFrames) {
                    const progress = animationPhase / movementFrames;
                    const startX = 143, startY = 92;
                    const endX = 75, endY = 110; 
                    mouseCursor.style.left = (startX + (endX - startX) * progress) + 'px';
                    mouseCursor.style.top = (startY + (endY - startY) * progress) + 'px';
                }
                
                else if (animationPhase <= movementFrames + 20) {
                    const clickPhase = animationPhase - movementFrames;

                    if (clickPhase >= 5) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseRightClick.style.visibility = 'visible';

                        widgetButtons.forEach(button => {
                            button.style.background = 'rgba(0,255,255,0.2)';
                            button.style.color = 'cyan';
                        });
                    }

                    movableWidget.style.left = '50px';
                    movableWidget.style.top = '60px';

                    mouseCursor.style.left = '75px';
                    mouseCursor.style.top = '110px';
                }
                
                else if (animationPhase <= movementFrames + 60) {
                    const moveProgress = (animationPhase - (movementFrames + 20)) / 40;
                    const startX = 50, startY = 60;
                    const endX = 200, endY = 60;
                    movableWidget.style.left = (startX + (endX - startX) * moveProgress) + 'px';
                    movableWidget.style.top = (startY + (endY - startY) * moveProgress) + 'px';

                    const widgetCenterX = startX + (endX - startX) * moveProgress + 25; 
                    const widgetCenterY = startY + (endY - startY) * moveProgress + 50; 
                    mouseCursor.style.left = (widgetCenterX - 8) + 'px'; 
                    mouseCursor.style.top = (widgetCenterY - 8) + 'px'; 

                    widgetButtons.forEach(button => {
                        button.style.background = 'rgba(0,255,255,0.2)';
                        button.style.color = 'cyan';
                    });
                }
                
                else if (animationPhase <= movementFrames + 70) {
                    
                    widgetButtons.forEach(button => {
                        button.style.background = 'transparent';
                        button.style.color = 'white';
                    });

                }
                
                else if (animationPhase <= movementFrames + 80) {
                    
                    mouseZeroClick.style.visibility = 'visible';
                    mouseRightClick.style.visibility = 'hidden';
                }
                
                else if (animationPhase <= movementFrames + 100) {
                    
                    movableWidget.style.left = '200px';
                    movableWidget.style.top = '60px';

                    mouseCursor.style.left = '225px';
                    mouseCursor.style.top = '110px';

                }
                
                else if (animationPhase <= movementFrames + 105) {
                    const clickPhase = animationPhase - (movementFrames + 100);

                    if (clickPhase >= 2) {
                        mouseZeroClick.style.visibility = 'hidden';
                        mouseRightClick.style.visibility = 'visible';

                        widgetButtons.forEach(button => {
                            button.style.background = 'rgba(0,255,255,0.2)';
                            button.style.color = 'cyan';
                        });
                    }
                }
                
                else if (animationPhase <= movementFrames + 125) {
                    const moveProgress = (animationPhase - (movementFrames + 105)) / 20;
                    const startX = 200, startY = 60;
                    const endX = 50, endY = 60;
                    movableWidget.style.left = (startX + (endX - startX) * moveProgress) + 'px';
                    movableWidget.style.top = (startY + (endY - startY) * moveProgress) + 'px';

                    const widgetCenterX = startX + (endX - startX) * moveProgress + 25; 
                    const widgetCenterY = startY + (endY - startY) * moveProgress + 50; 
                    mouseCursor.style.left = (widgetCenterX - 8) + 'px'; 
                    mouseCursor.style.top = (widgetCenterY - 8) + 'px'; 

                    widgetButtons.forEach(button => {
                        button.style.background = 'rgba(0,255,255,0.2)';
                        button.style.color = 'cyan';
                    });
                }
                
                else if (animationPhase <= movementFrames + 135) {
                    
                    widgetButtons.forEach(button => {
                        button.style.background = 'transparent';
                        button.style.color = 'white';
                    });

                }
                
                else if (animationPhase <= movementFrames + 145) {
                    mouseCursor.style.opacity = '0';
                }
                
                else if (animationPhase <= movementFrames + 153) {
                    
                }
                
                else {
                    animationPhase = 0;
                    movableWidget.style.left = '50px';
                    movableWidget.style.top = '60px';
                    mouseCursor.style.left = '143px';
                    mouseCursor.style.top = '92px';
                    mouseCursor.style.opacity = '1';

                    widgetButtons.forEach(button => {
                        button.style.background = 'transparent';
                        button.style.color = 'white';
                    });

                    mouseZeroClick.style.visibility = 'visible';
                    mouseRightClick.style.visibility = 'hidden';
                }

                updateProgress(animationPhase, totalAnimationFrames);

                const currentInterval = Math.round(baseInterval / animationSpeed);
                animationTimer = setTimeout(runAnimationFrame, currentInterval);
            }

            updateProgress(0, totalAnimationFrames);

            runAnimationFrame();
        }

        function restartAnimationWithNewSpeed() {
            if (animationTimer) {
                clearTimeout(animationTimer);
            }
            startAnimation();
        }

        function changeAnimationSpeed(newSpeed) {
            animationSpeed = newSpeed;
            
        }

        function updateProgress(phase, totalFrames) {
            const percentage = phase >= totalFrames ? 100 : (phase / totalFrames) * 100;
            progressBar.style.width = percentage + '%';

            if (phase <= 0) { 
                progressText.textContent = 'Préparation de la démonstration...'; 
                return; 
            }

            const describe = (p) => {
                if (p <= movementFrames) return 'Déplacement vers le widget';
                if (p <= movementFrames + 20) return 'Clic sur le widget';
                if (p <= movementFrames + 60) return 'Déplacement du widget (1ère phase)';
                if (p <= movementFrames + 70) return 'Arrêt et relâchement du clic';
                if (p <= movementFrames + 80) return 'Relâchement du clic';
                if (p <= movementFrames + 100) return 'Widget à destination';
                if (p <= movementFrames + 105) return 'Nouveau clic pour le retour';
                if (p <= movementFrames + 125) return 'Déplacement retour du widget';
                if (p <= movementFrames + 135) return 'Arrêt final';
                if (p <= movementFrames + 145) return 'Fin de la démonstration';
                return 'Préparation du redémarrage...';
            };

            progressText.textContent = describe(phase);
        }

        function togglePause() {
            isPaused = !isPaused;
            const pauseButton = document.getElementById('pauseButton');
            
            if (isPaused) {
                pauseButton.textContent = 'Reprendre';
                pauseButton.classList.add('paused');
            } else {
                pauseButton.textContent = 'Pause';
                pauseButton.classList.remove('paused');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            
            const startX = 143, startY = 92;
            const endX = 75, endY = 110; 
            const distance = Math.sqrt((endX - startX) ** 2 + (endY - startY) ** 2);
            movementFrames = Math.ceil(distance / CURSOR_SPEED_PX_PER_FRAME);

            totalAnimationFrames = movementFrames + 20 + 40 + 10 + 10 + 20 + 5 + 20 + 10 + 10 + 8; 
            
            console.log(`Distance: ${Math.round(distance)}px, Frames: ${movementFrames}, Vitesse: ${CURSOR_SPEED_PX_PER_FRAME}px/frame, Total: ${totalAnimationFrames}`);

            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            const pauseButton = document.getElementById('pauseButton');

            if (speedSlider && speedValue) {
                
                speedSlider.addEventListener('input', function() {
                    const newSpeed = parseFloat(this.value);
                    speedValue.textContent = newSpeed + 'x';
                    
                    console.log('Nouvelle vitesse (widget-move):', newSpeed);

                    changeAnimationSpeed(newSpeed);
                });

                speedValue.textContent = animationSpeed + 'x';
            } else {
                console.warn('Éléments du slider non trouvés dans demo-widget-move');
            }

            if (pauseButton) {
                pauseButton.addEventListener('click', togglePause);
            } else {
                console.warn('Bouton pause non trouvé dans demo-widget-move');
            }
            
            setTimeout(startAnimation, 1000);
        });
    </script>
</body>
</html>
